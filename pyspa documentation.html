<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>pyspa API documentation</title>
    <meta name="description" content="" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#modules.pyspa.INITIAL_HEADER_LIST">INITIAL_HEADER_LIST</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#modules.pyspa.get_spa">get_spa</a></li>
    <li class="mono"><a href="#modules.pyspa.load_instance_from_file">load_instance_from_file</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#modules.pyspa.Interface">Interface</a></span>
        
          
  <ul>
    <li class="mono"><a href="#modules.pyspa.Interface.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#modules.pyspa.Node">Node</a></span>
        
          
  <ul>
    <li class="mono"><a href="#modules.pyspa.Node.__init__">__init__</a></li>
    <li class="mono"><a href="#modules.pyspa.Node.get_flows">get_flows</a></li>
    <li class="mono"><a href="#modules.pyspa.Node.get_metadata">get_metadata</a></li>
    <li class="mono"><a href="#modules.pyspa.Node.get_node_attribute">get_node_attribute</a></li>
    <li class="mono"><a href="#modules.pyspa.Node.get_node_id">get_node_id</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#modules.pyspa.Pathway">Pathway</a></span>
        
          
  <ul>
    <li class="mono"><a href="#modules.pyspa.Pathway.__init__">__init__</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.add_transaction">add_transaction</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.del_transaction">del_transaction</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_direct_env_intensity">get_direct_env_intensity</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_flows">get_flows</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_fraction_of_total_intensity_for">get_fraction_of_total_intensity_for</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_id">get_id</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_intensity">get_intensity</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_nature">get_nature</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_num_nodes">get_num_nodes</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_num_transactions">get_num_transactions</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_short_id">get_short_id</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_stage_name">get_stage_name</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_tech_intensity">get_tech_intensity</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.get_unit">get_unit</a></li>
    <li class="mono"><a href="#modules.pyspa.Pathway.print_pathway">print_pathway</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#modules.pyspa.PathwayList">PathwayList</a></span>
        
          
  <ul>
    <li class="mono"><a href="#modules.pyspa.PathwayList.__init__">__init__</a></li>
    <li class="mono"><a href="#modules.pyspa.PathwayList.calculate_direct_requirements_dict">calculate_direct_requirements_dict</a></li>
    <li class="mono"><a href="#modules.pyspa.PathwayList.get_first_n_pathways">get_first_n_pathways</a></li>
    <li class="mono"><a href="#modules.pyspa.PathwayList.get_most_contributing_nodes">get_most_contributing_nodes</a></li>
    <li class="mono"><a href="#modules.pyspa.PathwayList.get_nature">get_nature</a></li>
    <li class="mono"><a href="#modules.pyspa.PathwayList.get_nb_pathways_per_flow">get_nb_pathways_per_flow</a></li>
    <li class="mono"><a href="#modules.pyspa.PathwayList.get_pathways_as_dataframe">get_pathways_as_dataframe</a></li>
    <li class="mono"><a href="#modules.pyspa.PathwayList.get_per_stage_results">get_per_stage_results</a></li>
    <li class="mono"><a href="#modules.pyspa.PathwayList.multiply">multiply</a></li>
    <li class="mono"><a href="#modules.pyspa.PathwayList.update_pathways_from_new_spa">update_pathways_from_new_spa</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#modules.pyspa.SupplyChain">SupplyChain</a></span>
        
          
  <ul>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.__init__">__init__</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.add_pathway">add_pathway</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.complete_analysis_lci">complete_analysis_lci</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.export_to_csv">export_to_csv</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.export_to_excel">export_to_excel</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.extract_pathways">extract_pathways</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.find_pathways">find_pathways</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.get_coverage_of">get_coverage_of</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.get_filename">get_filename</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.get_flows">get_flows</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.get_number_of">get_number_of</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.get_pathways">get_pathways</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.get_pathways_as_dict">get_pathways_as_dict</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.get_root_node">get_root_node</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.load">load</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.prepare_excel_export">prepare_excel_export</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.remove_pathway">remove_pathway</a></li>
    <li class="mono"><a href="#modules.pyspa.SupplyChain.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#modules.pyspa.TemporaryList">TemporaryList</a></span>
        
          
  <ul>
    <li class="mono"><a href="#modules.pyspa.TemporaryList.__init__">__init__</a></li>
    <li class="mono"><a href="#modules.pyspa.TemporaryList.already_exists">already_exists</a></li>
    <li class="mono"><a href="#modules.pyspa.TemporaryList.append">append</a></li>
    <li class="mono"><a href="#modules.pyspa.TemporaryList.is_empty">is_empty</a></li>
    <li class="mono"><a href="#modules.pyspa.TemporaryList.remove_last_item">remove_last_item</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#modules.pyspa.Transaction">Transaction</a></span>
        
          
  <ul>
    <li class="mono"><a href="#modules.pyspa.Transaction.__init__">__init__</a></li>
    <li class="mono"><a href="#modules.pyspa.Transaction.get_nodes">get_nodes</a></li>
    <li class="mono"><a href="#modules.pyspa.Transaction.get_stage">get_stage</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">pyspa</span> package</h1>
  <h2 class='titleonafterprint'><span class="authors">by <br>André Stephan (ORCID: 0000-0001-9538-3830) & <br>Paul-Antoine Bontinck (ORCID: 0000-0002-4072-1334)</span>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa" class="source">
    <div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module was built during the publically funded Australian Research Council DP150100962 project at the University of</span>
<span class="sd">Melbourne, Australia. It includes a set of Classes to conduct Structural Path Analysis (SPA) on input-output and process</span>
<span class="sd">data using environmental, social or financial satelliates. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__authors__</span> <span class="o">=</span> <span class="s1">&#39;Andre Stephan (ORCID: 0000-0001-9538-3830), &#39;</span> \
              <span class="s1">&#39;Paul-Antoine Bontinck (ORCID: 0000-0002-4072-1334)&#39;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.2&#39;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s1">&#39;Stable version&#39;</span>

<span class="c1"># global variables, used notably when outputing csv files</span>
<span class="n">INITIAL_HEADER_LIST</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f total intensity: &#39;</span><span class="p">,</span>
    <span class="s1">&#39;direct intensity of last node in pathway&#39;</span><span class="p">,</span>
    <span class="s1">&#39;total intensity of pathway&#39;</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">_get_clean_filename</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes all unacceptable characters from a name</span>
<span class="sd">    :param name: a string to be processed</span>
<span class="sd">    :return: a filename str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="s2">&quot;\/:*?&lt;&gt;|&quot;</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">_save_pickle</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use pickle/gzip to compress and save data</span>
<span class="sd">    :param data: data to save</span>
<span class="sd">    :param filename: name given to the pickle file, without the extension</span>
<span class="sd">    :param directory: directory where file will be saved</span>
<span class="sd">    :param file_extension: extension of the file to be saved</span>
<span class="sd">    :param path: the direct path to the file</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">file_extension</span>

    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="n">compresslevel</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_data</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file_data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">_load_pickle</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use pickle/gzip to load a compressed file</span>
<span class="sd">    :param filename: name of pickle file to open, without the extension</span>
<span class="sd">    :param directory: directory where file will be found</span>
<span class="sd">    :param file_extension: extension of the file to be loaded</span>
<span class="sd">    :param path: the direct path to the file</span>
<span class="sd">    :return: a variable containing the loaded data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">file_extension</span>

    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">,</span> <span class="n">compresslevel</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_data</span><span class="p">:</span>
        <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loaded_data</span>


<span class="k">def</span> <span class="nf">load_instance_from_file</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unpickles a file and initiates an instance of an object based on the loaded vars</span>
<span class="sd">    :param path: the path to the pickled file</span>
<span class="sd">    :param type_: the type of object to load, e.g. a Supply Chain object</span>
<span class="sd">    :return: the loaded object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="n">_load_pickle</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">type_</span><span class="p">(</span><span class="o">**</span><span class="n">loaded</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Interface</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the original creation of the supply chain object from csv files</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_matrix_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">thresholds_file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the Interface class by providing the paths to all required csv files</span>
<span class="sd">        :param a_matrix_file_path:</span>
<span class="sd">        :param infosheet_file_path:</span>
<span class="sd">        :param thresholds_file_path:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_matrix_file_path</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_flows_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresholds_file_path</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;thresholds_dict&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_loaded_files</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_multipliers_dicts</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;df&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the specified xls or csv file and converts it into a pandas dataframe by default or a numpy array by</span>
<span class="sd">        choice</span>
<span class="sd">        :param path: Path of the xls file to be read</span>
<span class="sd">        :param output: Specify dataframe or array if a numpy array is needed</span>
<span class="sd">        :return: ordered dict of ordered dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="s1">&#39;df&#39;</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;thresholds_dict&#39;</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Output must be &quot;df&quot; or &quot;array&quot; or &quot;thresholds_dict&quot;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">8</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="s1">&#39;df&#39;</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;thresholds_dict&#39;</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Output must be &quot;df&quot; or &quot;array&quot; or &quot;thresholds_dict&quot;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The excel file &#39;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span>
                      <span class="s1">&#39; is too large and will take too long to load. Please convert it to csv and load the csv &#39;</span>
                      <span class="s1">&#39;instead&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;The file should be either a .csv or .xls file&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">read_data</span>

    <span class="k">def</span> <span class="nf">_validate_loaded_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the number of sectors/processes in the A matrix and those in the infosheet dataframe</span>
<span class="sd">        Checks that all units have been provided in the sector infosheet</span>
<span class="sd">        Checks that the flows entered in the thresholds csv file are the same as those in the infosheet</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Your A matrix is not square.</span><span class="se">\n</span><span class="s1"> Please try loading a different file&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_matrix_sectors_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">infosheet_dataframe_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">a_matrix_sectors_num</span> <span class="o">!=</span> <span class="n">infosheet_dataframe_len</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Your A matrix contains &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a_matrix_sectors_num</span><span class="p">)</span>
                                 <span class="o">+</span> <span class="s1">&#39; sectors while your sectors information file contains &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">infosheet_dataframe_len</span><span class="p">)</span> <span class="o">+</span>
                                 <span class="s1">&#39; sectors.</span><span class="se">\n</span><span class="s1"> Please reload matching files&#39;</span><span class="p">)</span>

        <span class="n">satellite_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">satellite</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="k">for</span> <span class="n">satellite</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span>
                             <span class="n">satellite</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DR&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">satellite</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TR&#39;</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">satellite</span> <span class="ow">in</span> <span class="n">satellite_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">satellite</span> <span class="ow">or</span> <span class="s1">&#39;)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">satellite</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;No unit specified for satellite: &#39;</span> <span class="o">+</span> <span class="n">satellite</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;The flows defined in the infosheet are not the same as those defined in the thresholds file&#39;</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The A matrix loaded is square and contains &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; sectors/processes across &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_regions</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39; region(s), and described in the infosheet provided, for &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39; satellite(s)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the regions in ref_dataframe and determines which regions are actually included in the  file</span>
<span class="sd">        :param ref_dataframe: The infosheet containing all information about sectors/processes</span>
<span class="sd">        :return: List of regions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ref_dataframe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ref_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref_dataframe</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">_get_flows_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the keys in ref_dataframe and determines which environmental flows are included in the excel file</span>
<span class="sd">        :param ref_dataframe: The ordered dictionary generated by xls_to_dict which contains the information and</span>
<span class="sd">        environmental multipliers for each sector</span>
<span class="sd">        :return: List of flows</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ref_dataframe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ref_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span>

        <span class="n">flow</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Flow&#39;</span><span class="p">,</span> <span class="s1">&#39;name, unit&#39;</span><span class="p">)</span>
        <span class="n">attributes_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># generate a dictionary of flows names and flows named tupled by removing &#39;DR&#39; or &#39;TR&#39; from the string</span>
        <span class="c1"># and extracting the unit in between hyphens &#39;()&#39;</span>
        <span class="n">flows_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span> <span class="n">flow</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
                                              <span class="n">item</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">):</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span>
            <span class="n">item</span> <span class="ow">in</span> <span class="n">attributes_list</span> <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DR_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TR_&#39;</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">flows_dict</span>

    <span class="k">def</span> <span class="nf">_get_thresholds_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the thresholds csv file as a dataframe and converts it to a dictionary</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_generate_multipliers_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dataframe</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">flows_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the dicts of multipliers based on the reference dataframe and the flows to consider</span>
<span class="sd">        :param ref_dataframe: the infosheet dataframe</span>
<span class="sd">        :param flows_dict: the dictionary of flows considered</span>
<span class="sd">        :return: two dictionaries, one for direct requirements and the other for total reqs. They contain the flow</span>
<span class="sd">        as key and a numpy array of intensities/multipliers as value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ref_dataframe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ref_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span>
        <span class="k">if</span> <span class="n">flows_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span>

        <span class="n">dr_dict</span><span class="p">,</span> <span class="n">tr_dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">flow</span><span class="p">,</span> <span class="n">flow_tuple</span> <span class="ow">in</span> <span class="n">flows_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dr_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_dataframe</span><span class="p">[</span><span class="s1">&#39;DR_&#39;</span> <span class="o">+</span> <span class="n">flow</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">flow_tuple</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
            <span class="n">tr_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_dataframe</span><span class="p">[</span><span class="s1">&#39;TR_&#39;</span> <span class="o">+</span> <span class="n">flow</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">flow_tuple</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">dr_dict</span><span class="p">,</span> <span class="n">tr_dict</span>


<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent individual nodes in an input-output supply chain.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;index_reference&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;stage&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;direct_intensities&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;total_intensities&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;nature&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;root_node_boolean&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">}</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_reference</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">direct_intensities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                 <span class="n">total_intensities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the node class</span>
<span class="sd">        :param index_reference: index reference of the node, insert sector or process ID (ie the numerical value</span>
<span class="sd">        associated with the sector or process), based on the information sheet provided by the user</span>
<span class="sd">        :param stage: stage of the node in the supply chain, i.e. 0, 1, 2, ..., n</span>
<span class="sd">        :param direct_intensities: dictionary containing DIRECT environmental flows as keys (e.g. energy, water, GHG)</span>
<span class="sd">        and their intensities as values (e.g. 0.5)</span>
<span class="sd">        :param total_intensities: dictionary containing TOTAL environmental flows as keys (e.g. energy, water, GHG)</span>
<span class="sd">        and their intensities as values (e.g. 0.5)</span>
<span class="sd">        :param nature: nature of the data (Process or IO)</span>
<span class="sd">        :param unit: the functional unit of the sector or process represented by that node</span>
<span class="sd">        :return: a handle to the node object created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span> <span class="o">=</span> <span class="n">index_reference</span>  <span class="c1"># numerical index from 1 to the total number of sector or processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="n">stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct_intensities</span> <span class="o">=</span> <span class="n">direct_intensities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_intensities</span> <span class="o">=</span> <span class="n">total_intensities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>  <span class="c1"># IO or Process data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_node_boolean</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># used to check if we are dealing with the root node (Stage 0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># can be added via custom scripts</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Representation of a Node object when printed.</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;Index reference </span><span class="si">%s</span><span class="s1"> [S</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">get_node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the node ID by compounding its name, region and stage</span>
<span class="sd">        :return: node_ID string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">]]</span>
        <span class="n">node_id</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_strings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node_id</span>

    <span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadata or description of the node</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">get_flows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of the flows stored in the node</span>
<span class="sd">        :return: a list of flows</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_intensities</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_node_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an attribute of the Node object</span>
<span class="sd">        :param ref_dict: dictionary of attributes</span>
<span class="sd">        :param attribute: attribute</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node_boolean</span> <span class="ow">and</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;Name&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;DIRECT Stage 0&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ref_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># use for pickled nodes that do not use __slots__</span>
            <span class="k">return</span> <span class="n">ref_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Transaction</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a single transaction between two nodes in a supply chain.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;origin_node&#39;</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="s1">&#39;target_node&#39;</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="s1">&#39;tech_coeff&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;accum_tech_coeff&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;nature&#39;</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">}</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_node</span><span class="p">:</span> <span class="s2">&quot;Node Object&quot;</span><span class="p">,</span> <span class="n">target_node</span><span class="p">:</span> <span class="s2">&quot;Node Object&quot;</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">accum_tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nature</span><span class="o">=</span><span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the transaction class</span>
<span class="sd">        :param origin_node: Node object from which the transaction originates</span>
<span class="sd">        :param target_node: Node object at which the transaction ends</span>
<span class="sd">        :param tech_coeff: absolute technological intensity of the transaction, not related to the studied</span>
<span class="sd">        node downstream</span>
<span class="sd">        :param accum_tech_coeff: technological intensity of the transaction in relation to the studied node downstream</span>
<span class="sd">        :param nature: nature of the transaction, either Input-Output or Process</span>
<span class="sd">        :return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span> <span class="o">=</span> <span class="n">origin_node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span> <span class="o">=</span> <span class="n">target_node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tech_coeff</span> <span class="o">=</span> <span class="n">tech_coeff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accum_tech_coeff</span> <span class="o">=</span> <span class="n">accum_tech_coeff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Representation of a Transaction object when printed.</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;transaction from </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;/// &#39;</span> <span class="o">+</span> \
               <span class="s1">&#39;[Tech coeff: </span><span class="si">%s</span><span class="s1"> / Accumulated tech coeff: </span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tech_coeff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">accum_tech_coeff</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the origin and target nodes</span>
<span class="sd">        :param as_list: define format</span>
<span class="sd">        :return: origin and target node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">as_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the stage of the transaction</span>
<span class="sd">        :return: stage of the origin node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="o">.</span><span class="n">stage</span>


<span class="k">class</span> <span class="nc">Pathway</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a single pathway consisting of a series of nodes and transactions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;transactions&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;nature&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">}</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">transactions</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">nature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span>
                 <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the Pathway class.</span>
<span class="sd">        :param nodes: contains a list of consecutive Node Objects</span>
<span class="sd">        :param transactions: contains a list of consecutive Transaction Objects</span>
<span class="sd">        :param nature: type of data (i.e. input-output or process)</span>
<span class="sd">        :param number: adds the number of the pathway in the order of extraction, can be used for lists</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">transactions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">transactions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">transaction</span> <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="n">transactions</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Representation of a Pathway Object when printed</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transaction_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">:</span>
            <span class="n">transaction_string</span> <span class="o">+=</span> <span class="s1">&#39;[T&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">transaction</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span> <span class="o">+</span> \
                                  <span class="n">Transaction</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;Pathway: </span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">transaction_string</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares an instance of pathway to another by checking the equality of its attributes</span>
<span class="sd">        :param other: the other object used in the comparison</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Must be implemented to be able to use pathways in sets</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares an instance of pathway to another by checking the equality of its attributes</span>
<span class="sd">        :param other: the other object used in the comparison</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled_dict_</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">get_nature</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves nature of pathway, i.e. process or input-output</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nature</span>

    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the node ID by compounding its name, region and stage</span>
<span class="sd">        :return: pathway_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">())</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
        <span class="n">pathway_id</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_strings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pathway_id</span>

    <span class="k">def</span> <span class="nf">get_short_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a short ID for the pathway, by stitching the sector/process indices</span>
<span class="sd">        :return: pathway_short_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_of_node_indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
        <span class="n">pathway_short_id</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_node_indices</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pathway_short_id</span>

    <span class="k">def</span> <span class="nf">get_num_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the number of nodes</span>
<span class="sd">        :return: The number of nodes (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_num_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the number of transactions</span>
<span class="sd">        :return: The number of transactions (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_for_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the node exists in the Pathway Object</span>
<span class="sd">        :param node: a Node object</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_add_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the nodes of the transaction to the nodes list</span>
<span class="sd">        :param transaction: A transaction object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_node</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_del_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the origin_node of the transaction as it is the end of the pathway</span>
<span class="sd">        :param transaction: a Transaction object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">origin_node</span><span class="p">)</span>  <span class="c1"># make sure that there are no duplicate nodes</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">add_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a transaction to the Pathway Object by updating both the nodes and transactions list</span>
<span class="sd">        :param transaction: instance of a Transaction Object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_stage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">stage</span><span class="p">,</span> <span class="n">transaction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_nodes</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stage</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The specified transaction has been appended to the end of the pathway&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">del_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a transaction from the Pathway Object</span>
<span class="sd">        :param transaction: location of the Transaction Object to be removed</span>
<span class="sd">        :return: a list of Transaction Objects in the Pathway Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_stage</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_del_node</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="s2">&quot;The specified stage is too far upstream and is not contained in the pathway&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span>

    <span class="k">def</span> <span class="nf">get_direct_env_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the total direct environmental of the pathway</span>
<span class="sd">        :param flows: a list of flows for which we want the intensity</span>
<span class="sd">        :return: intensity of the pathway as a dict with flows as keys and the respective total intensity as values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># convert to float to avoid Numpy type errors in GUI</span>
                    <span class="n">intensity</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">direct_intensity</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;The requested environmental flow [</span><span class="si">%s</span><span class="s1">] could not be found.&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">flow</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">intensity</span>

    <span class="k">def</span> <span class="nf">get_tech_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines the total technological intensity of the pathway or up to a certain stage if specified</span>
<span class="sd">        :param stage: stage at which to get the technological intensity of the pathway</span>
<span class="sd">        :return: tech intensity as a float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">stage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">[</span><span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">accum_tech_coeff</span>

    <span class="k">def</span> <span class="nf">get_fraction_of_total_intensity_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rounding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">percentage</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the ratio of the direct requirement of the last node to the total requirement of the root node</span>
<span class="sd">        :param flow: the name of the environmental flow</span>
<span class="sd">        :param rounding: the number of digits potentially used for rounding</span>
<span class="sd">        :param percentage: return as percentage</span>
<span class="sd">        :return: float: fraction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>

        <span class="c1"># convert to float to avoid Numpy type errors in GUI</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rounding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">fraction</span><span class="p">,</span> <span class="n">rounding</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">percentage</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fraction</span>

    <span class="k">def</span> <span class="nf">get_stage_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">for_gui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">include_stage</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the name of the node for the specified stage</span>
<span class="sd">        :param ref_dict: the sector definition dict of the supply chain object</span>
<span class="sd">        :param stage: the stage in question</span>
<span class="sd">        :param for_gui: boolean flagging if the function is called from a gui</span>
<span class="sd">        :param include_stage: adds a prefix stating the stage of this node</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># need this syntax, not &#39;-1&#39;, to return last item since we need to print stage</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_stage</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;S</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">for_gui</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;The stage your are trying to access has not been reached in this pathway&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># used for gui</span>
                <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">include_stage</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;S0 </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">get_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rounding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the direct or total intensity of the pathway</span>
<span class="sd">        :param type_: the intensity type, i.e. direct or total</span>
<span class="sd">        :param flow: the name of the environmental flow</span>
<span class="sd">        :param rounding:the number of digits potentially used for rounding</span>
<span class="sd">        :param multiplier: multiply the intensity by this number, typically used to scale IO intensities using price</span>
<span class="sd">        :return: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;direct&#39;</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The type of intensity to calculate must be &quot;direct&quot; or &quot;total&quot;&#39;</span><span class="p">))</span>

        <span class="c1"># convert to float to avoid Numpy type errors in GUI</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">multiplier</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">*=</span> <span class="n">multiplier</span>

        <span class="k">if</span> <span class="n">rounding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">rounding</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">intensity</span>

    <span class="k">def</span> <span class="nf">print_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">streamlined</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                      <span class="n">to_csv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the pathway in ASCii characters as a csv file.</span>
<span class="sd">        :param flow: Flow being analysed</span>
<span class="sd">        :param ref_dict: the sector definition dict of the supply chain object</span>
<span class="sd">        :param streamlined: whether or not the output should be streamlined</span>
<span class="sd">        :param to_csv: whether the output is printed to a csv file or not</span>
<span class="sd">        :return: a string of output summarising data for the pathway</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;{:.5%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>  <span class="c1"># format the percentage of total requirements represented by the pathway</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_fraction_of_total_intensity_for</span><span class="p">(</span><span class="n">flow</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fraction_of_total_intensity_for</span><span class="p">(</span><span class="n">flow</span><span class="p">))</span>
        <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">))</span>
        <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_nodes</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_nodes</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;The pathway is empty, there are no nodes to print&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">start</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">streamlined</span><span class="p">:</span>
                <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
                <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
            <span class="n">output_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                <span class="n">output_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
            <span class="k">return</span> <span class="n">output_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">line_list</span>

    <span class="k">def</span> <span class="nf">get_flows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the set of flows from all Node Objects.</span>
<span class="sd">        :return: a list of flows</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flows_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">flows_set</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">flows_set</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()))</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">flows_set</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the functional unit of the root node</span>
<span class="sd">        :param ref_dict: the sector definition dict of the supply chain object</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Tried to retrieve the unit of the root node but this pathway has no nodes at all&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PathwayList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class inheriting list but overriding some of its functions to allow for calculations specific to lists of</span>
<span class="sd">    pathways in the context of hybrid analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;object_type&#39;</span><span class="p">:</span> <span class="n">Pathway</span><span class="p">}</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;object_type&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initiate the list instance based on list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_type</span> <span class="o">=</span> <span class="n">Pathway</span>
        <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">get_nature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves nature of pathway</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nature</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_nature</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">nature</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">calculate_direct_requirements_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the sum of all direct requirements of each last node found in the list of pathways provided</span>
<span class="sd">        :param flows_list: list of flows for which direct requirements should be summed</span>
<span class="sd">        :return: a dictionary of summed direct requirements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">summed_direct_requirement_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows_list</span><span class="p">:</span>
            <span class="n">summed_direct_requirement_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">dr</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">summed_direct_requirement_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dr</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">return</span> <span class="n">summed_direct_requirement_dict</span>

    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flows</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplies the direct requirements of last nodes by the specified value if they are io nodes</span>
<span class="sd">        and returns a copy of the list. Used to convert IO results from flow by financial output to flow by physical</span>
<span class="sd">        output.</span>
<span class="sd">        :param value: the scalar value by which to multiply</span>
<span class="sd">        :param flows: if None, get all flows from first node</span>
<span class="sd">        :return: a PathwayList Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span><span class="p">:</span>
                    <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">*=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">temp</span>

    <span class="k">def</span> <span class="nf">get_first_n_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number_of_pathways</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of pathways sorted in descending order for a particular flow, up to a &#39;n&#39; limit.</span>
<span class="sd">        :param flow: The particular flow for which the analysis is performed</span>
<span class="sd">        :param number_of_pathways: The number of pathways to be returned</span>
<span class="sd">        :param value: Price of the material being analysed, use only if pathways_list has not been multiplied before</span>
<span class="sd">        :return: A sorted and sliced PathwayList Object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_last_node_direct_intensity</span><span class="p">(</span><span class="n">pathway</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Nested function to extract the direct intensity of the last node of a pathway, for a given flow. Used to</span>
<span class="sd">            rank pathways</span>
<span class="sd">            :param pathway: Pathway object</span>
<span class="sd">            :return: Direct intensity value for a specific flow</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">number_of_pathways</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PathwayList</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_last_node_direct_intensity</span><span class="p">)[:</span><span class="n">number_of_pathways</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PathwayList</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_last_node_direct_intensity</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_pathways_as_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nb_stages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                                  <span class="n">header_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the PathwayList object as a pandas.DataFrame Object formatted for printing as a csv or Excel file.</span>
<span class="sd">        :param flows_list: list of flows considered in the SPA</span>
<span class="sd">        :param nb_stages: number of stages considered in the SPA</span>
<span class="sd">        :param ref_dict: The dictionary of reference of the SupplyChain object, containing metadata</span>
<span class="sd">        :param streamlined: whether the output is streamlined or not</span>
<span class="sd">        :param header_list: list of strings used as header for the pandas.DataFrame Object</span>
<span class="sd">        :return:ranked pandas DataFrame of pathways</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">header_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">header_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">INITIAL_HEADER_LIST</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_stages</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">streamlined</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1"> direct intensity&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header_list</span> <span class="o">=</span> <span class="n">header_list</span>

        <span class="n">pathway_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">header_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header_list</span><span class="p">)):</span>
            <span class="n">pathway_dict</span><span class="p">[</span><span class="n">header_list</span><span class="p">[</span><span class="n">header_index</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">pathway_data_to_print</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">print_pathway</span><span class="p">(</span><span class="n">flows_list</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">,</span> <span class="n">streamlined</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">header_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header_list</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pathway_dict</span><span class="p">[</span><span class="n">header_list</span><span class="p">[</span><span class="n">header_index</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway_data_to_print</span><span class="p">[</span><span class="n">header_index</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">pathway_dict</span><span class="p">[</span><span class="n">header_list</span><span class="p">[</span><span class="n">header_index</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">pathway_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">pathway_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pathway_df</span>

    <span class="k">def</span> <span class="nf">get_per_stage_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_node</span><span class="p">:</span> <span class="s1">&#39;Node Object&#39;</span><span class="p">,</span> <span class="n">nb_stages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">flow_coverage</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                              <span class="n">as_absolute</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the results of the SPA on a per stage basis. Includes the sum of all direct</span>
<span class="sd">        requirements of Stage nodes, as well as the percentage of the total requirements this represents.</span>
<span class="sd">        :param root_node: Root node of the analysis (original target node)</span>
<span class="sd">        :param nb_stages: Number of stages considered in the SPA</span>
<span class="sd">        :param flow_coverage: Total coverage of the SPA</span>
<span class="sd">        :param flow: flow for which the analysis is run</span>
<span class="sd">        :param as_absolute: whether the results are provided as absolute values or as a percentage of the total.</span>
<span class="sd">        :return: stage_total_dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stage_total_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_stages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Stage 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Remainder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">node_value</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
            <span class="n">node_stage</span> <span class="o">=</span> <span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span><span class="p">)</span>
            <span class="n">stage_total_dict</span><span class="p">[</span><span class="n">node_stage</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">node_value</span><span class="p">)</span>
        <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Remainder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">flow_coverage</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">as_absolute</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stage_number</span><span class="p">,</span> <span class="n">stage_total</span> <span class="ow">in</span> <span class="n">stage_total_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">stage_total_dict</span><span class="p">[</span><span class="n">stage_number</span><span class="p">]</span> <span class="o">/</span> <span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
                <span class="n">stage_total_dict</span><span class="p">[</span><span class="n">stage_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">stage_total_dict</span>

    <span class="k">def</span> <span class="nf">get_nb_pathways_per_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function used to return the number of nodes which include data for each specific flow (because of thresholds</span>
<span class="sd">        testing, some flows are not covered in the direct intensities dict of the nodes).</span>
<span class="sd">        :param flows: list of flows for which the analysis should be conducted.</span>
<span class="sd">        :return: node_count_dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
        <span class="c1"># print(flows)</span>
        <span class="n">node_count_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">flow</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="n">node_count_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">return</span> <span class="n">node_count_dict</span>

    <span class="k">def</span> <span class="nf">get_most_contributing_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectors_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">sectors_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">flows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates through all Pathway objects in the list and account for the overall contribution of a sector</span>
<span class="sd">        :param sectors_list: List of all sectors or processes covered by the database</span>
<span class="sd">        :param sectors_dict: Sectors_definition_dict object - included in the relevant .lci file</span>
<span class="sd">        :param flows: List of flows to be covered</span>
<span class="sd">        :return: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>

        <span class="n">root_total_intensities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="n">root_total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="n">contribution_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">contribution_dict</span><span class="p">[</span><span class="s1">&#39;Direct Stage 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="n">sectors_list</span><span class="p">:</span>
            <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
                <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="n">contribution_dict</span><span class="p">[</span><span class="s1">&#39;Direct Stage 0&#39;</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
                <span class="n">last_node</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">last_node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">last_node</span><span class="o">.</span><span class="n">root_node_boolean</span><span class="p">:</span>
                        <span class="n">node_sector</span> <span class="o">=</span> <span class="s1">&#39;Direct Stage 0&#39;</span>
                        <span class="c1"># print(sectors_dict[last_node.index_reference][&#39;Name&#39;])</span>
                        <span class="n">root_total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">node_sector</span> <span class="o">=</span> <span class="n">sectors_dict</span><span class="p">[</span><span class="n">last_node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
                    <span class="n">contribution_dict</span><span class="p">[</span><span class="n">node_sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="n">last_node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">sector</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">contribution_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
                <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">/</span> <span class="n">root_total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">contribution_dict</span>

    <span class="k">def</span> <span class="nf">update_pathways_from_new_spa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spa_pathways_results_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">return_no_match_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trims a Pathway Object based on a specified max_stage and threshold dictionary</span>
<span class="sd">        :param spa_pathways_results_dict: a dictionary of spa short_ids and pathways as k, v</span>
<span class="sd">        that is used to replace current pathways</span>
<span class="sd">        :param return_no_match_list: a boolean flag to return or not the short_ids of pathways that could&#39;nt be replaced</span>
<span class="sd">        :return: a PathwayList Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_as_ids</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_short_id</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">new_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
        <span class="n">no_match_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">spa_id</span> <span class="ow">in</span> <span class="n">self_as_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spa_pathways_results_dict</span><span class="p">[</span><span class="n">spa_id</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">no_match_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spa_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_no_match_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_list</span><span class="p">,</span> <span class="n">no_match_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_list</span>


<span class="k">class</span> <span class="nc">TemporaryList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class inheriting list but overriding some of its functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;parent_sc&#39;</span><span class="p">:</span> <span class="s1">&#39;SupplyChain&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">}</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_sc</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span> <span class="ow">or</span> <span class="s1">&#39;transactions&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initiate the list instance based on list</span>
<span class="sd">        :param parent_sc: the parent supply chain object</span>
<span class="sd">        :param _type: defines</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_sc</span> <span class="o">=</span> <span class="n">parent_sc</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">_type</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deep copy function (creates a completely copied object)</span>
<span class="sd">        :param memo: data to be copied</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">memo</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">),</span> <span class="n">memo</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">target_node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends an item to the TemporaryList Object.</span>
<span class="sd">        :param item: a node or transaction item to append</span>
<span class="sd">        :param target_node: the target node that the node item is linked to, use only if type is node</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_node</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">(</span><span class="n">target_node</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_nodes_consistency</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Trying to append a node with the wrong stage sequence&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>  <span class="c1"># if we&#39;re adding the root node</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_nodes_consistency</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Trying to append a node with the wrong stage sequence&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># raising the type error is causing trouble with copy.deepcopy</span>
                <span class="c1"># raise TypeError(&#39;The target node passed to the append method is not a Node&#39;)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;transactions&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_transaction_consistency</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="c1"># print(&#39;adding the following transaction ==&gt; &#39;, item)</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Trying to append a transaction with the wrong target node&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># raising the type error is causing trouble with copy.deepcopy</span>
            <span class="c1"># raise TypeError(&#39;The item passed to the append method of the&#39;</span>
            <span class="c1">#                 &#39; TemporaryList class is not a Node or a Transaction&#39;)</span>

    <span class="k">def</span> <span class="nf">already_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the item is already in the TemporaryList object</span>
<span class="sd">        :param item: A Node or Transaction object</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleans up the list by removing superfluous nodes/transactions</span>
<span class="sd">        :param target: A Node or Transaction object to be cleaned up from the TemporaryList object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&#39;============== CLEANING UP == &#39;, self._type)</span>
        <span class="c1"># print(&#39;state BEFORE cleanup --&gt; &#39;, self)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cleanup_index</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_from_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># print(&#39;\n&#39;,&#39;state AFTER cleanup --&gt; &#39;, self, &#39;\n\n&#39;)</span>

    <span class="k">def</span> <span class="nf">_clear_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Truncates the TemporaryList object from the index onwards, keeps only the first part</span>
<span class="sd">        :param index: the index that we use to truncate the list</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;transactions&#39;</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">==</span> <span class="s1">&#39;clear transactions list&#39;</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span>  <span class="c1"># empties the lists</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_get_cleanup_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Node</span> <span class="ow">or</span> <span class="n">Transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines the index in the TemporaryList object until which we need to keep the elements</span>
<span class="sd">        :param target: A Node or Transaction object that is used to determine the index from which the list is cleared</span>
<span class="sd">        :return: the index in question</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
            <span class="n">target_node_id</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">running_index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="o">==</span> <span class="n">target_node_id</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">running_index</span>
            <span class="k">return</span> <span class="n">index</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="n">target_node_id</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">target_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">target_node_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_sc</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">():</span>
                <span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;clear transactions list&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">running_index</span><span class="p">,</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="n">running_origin_node_id</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">origin_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">running_origin_node_id</span> <span class="o">==</span> <span class="n">target_node_id</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">running_index</span>
            <span class="k">return</span> <span class="n">index</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The target item passed is neither a Node nor a Transaction object&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_last_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the last node/transaction in the TemporaryList object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the TemporaryList object is empty</span>
<span class="sd">        :return: True or false</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_check_nodes_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes sure that all nodes in the TemporaryList object are properly ordered by stage</span>
<span class="sd">        :return: True or false</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="c1"># print(&#39;temp nodes is empty -&gt; Can add node&#39;)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># print(&#39;temp nodes has one node -&gt; can add node&#39;)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="n">node</span><span class="o">.</span><span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># print(&#39;Stages of node to add is sequentially consistent...adding node&#39;)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if the stage of the node to append is not sequentially correct</span>
            <span class="c1"># print(&#39;NODES INCONSISTENT&#39;)</span>
            <span class="c1"># print(&#39;Stage of last node in temp -- &gt; &#39;, self[-1].stage)</span>
            <span class="c1"># print(&#39;Stage of node to add  -- &gt; &#39;, node.stage)</span>
            <span class="c1"># print(&#39;state of temp_nodes --&gt; &#39;, self)</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_check_transaction_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes sure that all Transaction objects in the TemporaryList object are properly ordered in terms of origin</span>
<span class="sd">        and target Node objects.</span>
<span class="sd">        :param transaction: a Transaction object</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">origin_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="o">==</span> <span class="n">transaction</span><span class="o">.</span><span class="n">target_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">():</span>
            <span class="c1"># print(&#39;Stages of node to add is sequentially consistent...adding node&#39;)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if the stage of the node to append is not sequentially correct</span>
            <span class="c1"># print(&#39;NODES INCONSISTENT&#39;)</span>
            <span class="c1"># print(&#39;Stage of last node in temp -- &gt; &#39;, self[-1].stage)</span>
            <span class="c1"># print(&#39;Stage of node to add  -- &gt; &#39;, node.stage)</span>
            <span class="c1"># print(&#39;state of temp_nodes --&gt; &#39;, self)</span>
            <span class="k">return</span> <span class="bp">False</span>


<span class="k">class</span> <span class="nc">SupplyChain</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class representing the entire supply chain associated with an input-output sector or with a process.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;target_ID&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;sector_definition_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;a_matrix&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="s1">&#39;dr_vectors_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;tr_vectors_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;thresholds_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;max_stage&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;nature&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;header_line&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;chosen_flows_list&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;temp_nodes&#39;</span><span class="p">:</span> <span class="n">TemporaryList</span><span class="p">,</span>
        <span class="s1">&#39;temp_transactions&#39;</span><span class="p">:</span> <span class="n">TemporaryList</span><span class="p">,</span>
        <span class="s1">&#39;pathways_list&#39;</span><span class="p">:</span> <span class="n">PathwayList</span><span class="p">,</span>
        <span class="s1">&#39;root_node&#39;</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="s1">&#39;calculations_in_progress&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="s1">&#39;flows_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">}</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ID</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sectors_definition_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">a_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">dr_vectors_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                 <span class="n">tr_vectors_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">thresholds_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">flows_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
                 <span class="n">nature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span> <span class="n">pathways_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">root_node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the supply chain class.</span>
<span class="sd">        :param target_ID: the target sector number for which the supply chain is created</span>
<span class="sd">        :param sector_definition_dict: a dictionary listing the sector numbers and their characteristics</span>
<span class="sd">        :param a_matrix: the technological matrix of the input-output tables considered</span>
<span class="sd">        :param dr_vectors_dict: a dictionary of vectors of direct flow intensity for each flow assessed and each</span>
<span class="sd">        sector of the A matrix</span>
<span class="sd">        :param tr_vectors_dict: a dictionary of vectors of total flow intensity for each flow assessed and each</span>
<span class="sd">        sector of the A matrix</span>
<span class="sd">        :param thresholds_dict: a dictionary of thresholds for each flow analysed - thresholds can be modified from</span>
<span class="sd">        flow to flow</span>
<span class="sd">        :param flows_dict: a dictionary containing flow names as keys (e.g. &#39;energy&#39;) and a sub dictionary containing</span>
<span class="sd">        the &#39;name&#39; and &#39;unit&#39; of that flow.</span>
<span class="sd">        :param max_stage: the maximum number of stages upstream to consider during the SPA - the ultimate maximum stage</span>
<span class="sd">        is currently five.</span>
<span class="sd">        :param nature: specifies whether the supply chain data is pure input-output or process.</span>
<span class="sd">        :param pathways_list: the list of pathways constituting the supply chain, only used for loading from a pickle</span>
<span class="sd">        :param root_node: the root node object of the supply chain, only used for loading from a pickle</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">=</span> <span class="n">target_ID</span>  <span class="c1"># numerical index of the sector or process being analysed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span> <span class="o">=</span> <span class="n">sectors_definition_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span> <span class="o">=</span> <span class="n">a_matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span> <span class="o">=</span> <span class="n">dr_vectors_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span> <span class="o">=</span> <span class="n">tr_vectors_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span> <span class="o">=</span> <span class="n">flows_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">=</span> <span class="n">max_stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="o">=</span> <span class="n">thresholds_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">header_line</span> <span class="o">=</span> \
            <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f total intensity</span><span class="se">\t</span><span class="s1">direct intensity of last node in pathway</span><span class="se">\t</span><span class="s1">total intensity of pathway</span><span class="se">\t</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span> <span class="o">=</span> <span class="n">TemporaryList</span><span class="p">(</span><span class="n">parent_sc</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span> <span class="o">=</span> <span class="n">TemporaryList</span><span class="p">(</span><span class="n">parent_sc</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s1">&#39;transactions&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pathways_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">pathways_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_data</span><span class="p">()</span>  <span class="c1"># initiate tests on the variables to check that their format is correct</span>

        <span class="k">if</span> <span class="n">root_node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_root_node</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="n">root_node</span>

        <span class="c1"># generate all necessary functions to extract pathways up to the max stage. Avoids recursive code.</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">_add_extraction_stage</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculations_in_progress</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># use as a flag for progress dialogs</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Representation of a SupplyChain object when printed.</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;SupplyChain =&gt; Target: </span><span class="si">%s</span><span class="s1">, Max Stage: </span><span class="si">%s</span><span class="s1">, Nature: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares an instance of a SupplyChain object to another by checking the equality of its attributes</span>
<span class="sd">        :param other: the other object used in the comparison</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">target_ID</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="ow">and</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_stage</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares an instance of a supply chain to another by checking the equality of its attributes</span>
<span class="sd">        :param other: the other object used in the comparison</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deep copy function (creates a completely copied object)</span>
<span class="sd">        :param memo: data to be copied</span>
<span class="sd">        :return: copied object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">memo</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">),</span> <span class="n">memo</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">_validate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A series of tests used to validate the initiated data. It verifies whether the dictionary of thresholds</span>
<span class="sd">        provided contains any information, whether it is as long as the list of flows used for the analysis, and</span>
<span class="sd">        whether the thresholds are within acceptable ranges. It then verifies that the dictionary of vectors provided</span>
<span class="sd">        for TR and DR are in line with the flows assessed, and are provided as numpy arrays. Finally it checks if the</span>
<span class="sd">        number of stages set to be considered is within the scope of the code (ie whether or not it is greater than</span>
<span class="sd">        the ultimate maximum stage).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Test on thresholds_dict STARTS</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The thresholds dictionary is empty&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The thresholds dictionary includes </span><span class="si">%s</span><span class="s1"> too many flows&#39;</span> <span class="o">%</span>
                             <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">flow</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">threshold</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">threshold</span> <span class="o">&lt;</span> <span class="mf">0.0000000001</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The threshold defined for </span><span class="si">%s</span><span class="s1"> is outside the scope.&#39;</span> <span class="o">%</span> <span class="n">flow</span><span class="p">)</span>

        <span class="c1"># Test on dr_vector_dict and tr_vector_dict STARTS</span>
        <span class="k">for</span> <span class="n">flow</span><span class="p">,</span> <span class="n">arrays</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">flow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not included in the current list of flows&#39;</span> <span class="o">%</span> <span class="n">flow</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value provided for </span><span class="si">%s</span><span class="s1"> is not a numpy array&#39;</span> <span class="o">%</span> <span class="n">flow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_pathways_as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dictionary containing the pathway index as a key and the pathway object as a value</span>
<span class="sd">        :param list_of_pathway_indices: a custom list of pathway indices</span>
<span class="sd">        :return: a dictionary of pathways with pathway index as keys and a PathwayList object as a value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pathways_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">list_of_pathway_indices</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pathway_num</span><span class="p">,</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">):</span>
                <span class="n">pathways_dict</span><span class="p">[</span><span class="n">pathway_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathway</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span>
                <span class="n">pathways_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pathways_dict</span>

    <span class="k">def</span> <span class="nf">get_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">list_of_pathway_short_ids</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all pathways as a list, or a list of specified pathways, by indices</span>
<span class="sd">        :param list_of_pathway_indices: a custom list of pathway indices</span>
<span class="sd">        :param list_of_pathway_short_ids: a custom list of pathway short ids</span>
<span class="sd">        :return: a PathwayList object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pathways_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">list_of_pathway_indices</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">list_of_pathway_short_ids</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pathways_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>
        <span class="k">elif</span> <span class="n">list_of_pathway_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span>
                <span class="n">pathways_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">list_of_pathway_short_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pathways_list</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">pathway</span> <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_short_id</span><span class="p">()</span> <span class="ow">in</span> <span class="n">list_of_pathway_short_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pathways_list</span>

    <span class="k">def</span> <span class="nf">find_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_indices_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all Pathway objects in which the specified node indices occur</span>
<span class="sd">        :param node_indices_list: a list of node indices</span>
<span class="sd">        :return: a dictionary of pathways, with node indices as keys and a list of matching pathway indices as a value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matching_pathways</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pathway_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># skip the root node</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">index_reference</span> <span class="ow">in</span> <span class="n">node_indices_list</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matching_pathways</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="n">matching_pathways</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway_number</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">matching_pathways</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathway_number</span><span class="p">]</span>
            <span class="n">pathway_number</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">matching_pathways</span>

    <span class="k">def</span> <span class="nf">get_coverage_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the coverages of the specified flow in the current SupplyChain object</span>
<span class="sd">        :param flow: the specified flow, as a string, e.g. &#39;energy&#39;, &#39;water&#39;, &#39;carbon&#39;</span>
<span class="sd">        :param rounding: round the results to the specified number of digits</span>
<span class="sd">        :return: a ratio of the total intensity covered by the SupplyChain object, as a float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">covered_flows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">flow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">covered_flows</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The specified flow was not covered in this structural path analysis&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_direct_intensity_covered</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># self.root_node.direct_intensities[flow]</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">total_direct_intensity_covered</span> <span class="o">+=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">percentage_covered</span> <span class="o">=</span> <span class="n">total_direct_intensity_covered</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                <span class="n">percentage_covered</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># if the total is zero, then the share is 0</span>

            <span class="k">if</span> <span class="n">rounding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">percentage_covered</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">percentage_covered</span><span class="p">,</span> <span class="n">rounding</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">percentage_covered</span>

    <span class="k">def</span> <span class="nf">get_flows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of flows covered</span>
<span class="sd">        :return: a list object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_root_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the root node of the supply chain</span>
<span class="sd">        :return: a Node object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span>

    <span class="k">def</span> <span class="nf">_generate_root_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the root Node object of the SupplyChain object.</span>
<span class="sd">        :return: a root Node object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_dr_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">node_tr_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
            <span class="n">node_dr_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">]</span>
            <span class="n">node_tr_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;process&#39;</span><span class="p">:</span>
            <span class="n">root_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">index_reference</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">,</span>
                             <span class="n">stage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">direct_intensities</span><span class="o">=</span><span class="n">node_dr_dict</span><span class="p">,</span> <span class="n">total_intensities</span><span class="o">=</span><span class="n">node_tr_dict</span><span class="p">,</span>
                             <span class="n">nature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">,</span>
                             <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">][</span><span class="s1">&#39;Unit&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;The nature of the SupplyChain object was not recognised. Make sure it is either &#39;process&#39; &quot;</span>
                <span class="s2">&quot;or &#39;io&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">root_node</span>

    <span class="k">def</span> <span class="nf">get_number_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count_what</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span> <span class="ow">or</span> <span class="s1">&#39;transactions&#39;</span> <span class="ow">or</span> <span class="s1">&#39;pathways&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the number of nodes in the SupplyChain object.</span>
<span class="sd">        :param count_what: specify what object is being counted, i.e. &#39;nodes&#39;, &#39;transactions&#39;, &#39;pathways&#39;</span>
<span class="sd">        :return: Number of object (int) in the supply chain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;pathways&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">or</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;transactions&#39;</span><span class="p">:</span>
            <span class="n">num_nodes</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">num_transactions</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">:</span>
                <span class="n">num_nodes</span> <span class="o">+=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_num_nodes</span><span class="p">()</span>
                <span class="n">num_transactions</span> <span class="o">+=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_num_transactions</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">num_nodes</span>
            <span class="k">elif</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;transactions&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">num_transactions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Count what must be &#39;nodes&#39;, &#39;transactions&#39;, or &#39;pathways&#39;&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">add_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathway</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the specified Pathway object to the SupplyChain object.</span>
<span class="sd">        :param pathway: a Pathway object</span>
<span class="sd">        :return: an updated PathwayList object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>

    <span class="k">def</span> <span class="nf">remove_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathway</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the specified Pathway object from the SupplyChain object.</span>
<span class="sd">        :param pathway: a Pathway object</span>
<span class="sd">        :return: an updated PathwayList object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>

    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a filename for the supply chain object</span>
<span class="sd">        :param full: boolean referring to whether the filename is requested is long or short.</span>
<span class="sd">        :return: filename string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;sectors&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;process&#39;</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;processes&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The nature of an spa can only be &quot;io&quot; or &quot;process&quot;&#39;</span><span class="p">))</span>

        <span class="n">clean_target_name</span> <span class="o">=</span> <span class="n">_get_clean_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">num_sectors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">flows_str</span> <span class="o">=</span> <span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;{}_threshold_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s1">&#39;SPA&#39;</span><span class="p">,</span>
                <span class="n">clean_target_name</span><span class="p">,</span>
                <span class="s1">&#39;( </span><span class="si">%s</span><span class="s1"> )&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">),</span>
                <span class="s1">&#39;Max_stage&#39;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">),</span>
                <span class="n">flows_str</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">num_sectors</span><span class="p">),</span>
                <span class="n">suffix</span>
            <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s1">&#39;SPA&#39;</span><span class="p">,</span>
                <span class="n">clean_target_name</span><span class="p">,</span>
                <span class="s1">&#39;( </span><span class="si">%s</span><span class="s1"> )&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">),</span>
                <span class="s1">&#39;Max_stage&#39;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">)</span>
            <span class="p">])</span>
        <span class="k">return</span> <span class="n">filename</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the SupplyChain object to a file.</span>
<span class="sd">        :param path: directory where the SupplyChain object is saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">attribute</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span> <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">}</span>
        <span class="n">_save_pickle</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">temp_dict</span>
        <span class="c1"># with gzip.open(path, &#39;wb&#39;) as file:</span>
        <span class="c1">#     pickle.dump(vars(self), file)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the SupplyChain object from a file.</span>
<span class="sd">        :param path: directory from which the SupplyChain object is loaded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="n">loaded_vars</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">=</span> <span class="n">loaded_vars</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">loaded_vars</span><span class="p">[</span><span class="s1">&#39;pathways_list&#39;</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> loaded successfully&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_file_title_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a title block for the file exported reporting a summary of information on the SPA that has been</span>
<span class="sd">        conducted.</span>
<span class="sd">        :param to_csv: boolean flag referencing whether the data is to be saved to csv file or not</span>
<span class="sd">        :return: analysis metadata in the form of a list of strings to be used for the file header</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_title_block</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;target sector: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">])],</span>
            <span class="p">[</span><span class="s1">&#39;sector ID: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;no sectors in A matrix: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
            <span class="p">[</span><span class="s1">&#39;total no pathways extracted: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;stages analysed: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;date of extraction: &#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%x</span><span class="s2">&quot;</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;time of extraction: &#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%X</span><span class="s2">&quot;</span><span class="p">)]</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
            <span class="n">new_title_block</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file_title_block</span><span class="p">:</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">new_title_block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_title_block</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">file_title_block</span>

    <span class="k">def</span> <span class="nf">_generate_spa_title_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a title block for the SPA results produced for each flows.</span>
<span class="sd">        :param flow: flow being analysed</span>
<span class="sd">        :param to_csv: boolean flag referencing whether the data is to be saved to csv file or not</span>
<span class="sd">        :return: title block of the SPA results for a particular flow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">flow_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The flow </span><span class="si">%s</span><span class="s1"> is not defined&#39;</span> <span class="o">%</span> <span class="n">flow</span><span class="p">)</span>

        <span class="n">spa_title_block_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;flow analysed:&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;unit:&#39;</span><span class="p">,</span>
             <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">flow_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;thresholds:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">])],</span>
            <span class="p">[</span><span class="s1">&#39;direct:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
             <span class="p">(</span><span class="n">flow_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;total:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
             <span class="p">(</span><span class="n">flow_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f total covered by SPA:&#39;</span><span class="p">,</span> <span class="s2">&quot;{:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_coverage_of</span><span class="p">(</span><span class="n">flow</span><span class="p">)),</span>
             <span class="s1">&#39;Note: Value may differ from sum of percentages in the table due to rounding&#39;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
            <span class="n">new_spa_title_block_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">spa_title_block_list</span><span class="p">:</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">new_spa_title_block_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_spa_title_block_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spa_title_block_list</span>

    <span class="k">def</span> <span class="nf">_generate_spa_table_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a header for each table of SPA results.</span>
<span class="sd">        :param streamlined: whether the SPA table results is streamlined or not</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header_line</span> <span class="o">=</span> <span class="n">INITIAL_HEADER_LIST</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">streamlined</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">header_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1"> direct intensity&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">header_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">header_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">header_line</span>

    <span class="k">def</span> <span class="nf">prepare_excel_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare SPA for an excel export - compile the data as a series of pandas.DataFrame in a dictionary</span>
<span class="sd">        :param streamlined: whether or not the output is streamlined (i.e. a shorter number of header is defined if</span>
<span class="sd">        streamlined)</span>
<span class="sd">        :return: dictionary of pd.DataFrames</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_data_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">block_title_lists</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_file_title_block</span><span class="p">(</span><span class="n">to_csv</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
            <span class="n">spa_title_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_spa_title_block</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">block_title_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spa_title_block</span><span class="p">)</span>

        <span class="n">updated_block_title_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">list_</span> <span class="ow">in</span> <span class="n">block_title_lists</span><span class="p">:</span>  <span class="c1"># there is one general summary list and as many other list as flows</span>
            <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">:</span>
                <span class="n">modified_row</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span>
                <span class="n">updated_block_title_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_row</span><span class="p">)</span>
            <span class="n">updated_block_title_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">block_title_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">updated_block_title_list</span><span class="p">)</span>
        <span class="n">df_data_dict</span><span class="p">[</span><span class="s1">&#39;Summary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">block_title_df</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
            <span class="n">flow_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_pathways_as_dataframe</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span>
                                                                   <span class="n">streamlined</span><span class="p">)</span>
            <span class="n">df_data_dict</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">flow_df</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df_data_dict</span>

    <span class="k">def</span> <span class="nf">export_to_excel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the SupplyChain object results to a series of excel spreadsheet (according to the number of flows</span>
<span class="sd">        being covered by the Structural Path Analysis)</span>
<span class="sd">        :param path: directory of the file to be created (including directory and name).</span>
<span class="sd">        :param streamlined: whether or not the output is streamlined - meaning that the number of columns of the spa</span>
<span class="sd">        results table will vary to include the DR of all nodes in the pathways, or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
        <span class="n">df_data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_excel_export</span><span class="p">(</span><span class="n">streamlined</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">df_name</span><span class="p">,</span> <span class="n">df_data_list</span> <span class="ow">in</span> <span class="n">df_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">df_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df_data_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="n">df_data_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">export_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the SupplyChain object to a csv file.</span>
<span class="sd">        :param path: directory of the file to be created (including directory and name).</span>
<span class="sd">        :param streamlined: whether or not the output is streamlined (the number of columns of the spa results table</span>
<span class="sd">        will include the DR of all nodes in the pathways, or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
            <span class="n">output_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_file_title_block</span><span class="p">(</span><span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">line</span><span class="p">])</span>
            <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_spa_title_block</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                    <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">line</span><span class="p">])</span>
                <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_spa_table_header</span><span class="p">(</span><span class="n">streamlined</span><span class="p">)])</span>
                <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_first_n_pathways</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">)):</span>
                    <span class="c1"># write up pathways extracted</span>
                    <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">print_pathway</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span> <span class="n">ref_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span>
                                                     <span class="n">streamlined</span><span class="o">=</span><span class="n">streamlined</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">line</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sector_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">property_</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the specified property_ of the sector with the associated ID.</span>
<span class="sd">        :param: sector_id: ID of the sector in the reference dict</span>
<span class="sd">        :param: property_: key name of the property_ to retrieve in the dictionary of reference</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">sector_id</span><span class="p">][</span><span class="n">property_</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The specified property_ &#39;</span><span class="p">,</span> <span class="n">property_</span><span class="p">,</span> <span class="s1">&#39; was not found for sector ID &#39;</span><span class="p">,</span> <span class="n">sector_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="s1">&#39;list of nodes&#39;</span><span class="p">,</span> <span class="n">transactions</span><span class="p">:</span> <span class="s1">&#39;list of transactions&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a list of nodes and a list of transactions into a pathway object.</span>
<span class="sd">        :param nodes: a list of nodes instances</span>
<span class="sd">        :param transactions: a list of transactions instances</span>
<span class="sd">        :return: a Pathway Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the number of the pathway in the list</span>
        <span class="c1"># add 1 to save the first spot for DIRECT requirements</span>
        <span class="c1"># use for logs and to display</span>
        <span class="n">pathway_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">pathway</span> <span class="o">=</span> <span class="n">Pathway</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">transactions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">,</span> <span class="n">pathway_num</span><span class="p">)</span>
        <span class="c1"># pathway.print_pathway(ref_dict=self.sector_definition_dict)</span>
        <span class="k">return</span> <span class="n">pathway</span>

    <span class="k">def</span> <span class="nf">_insert_direct_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts an additional pathway to represent the direct requirements at stage 0 of the supply chain</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">renamed_root_node</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="p">)</span>
        <span class="n">renamed_root_node</span><span class="o">.</span><span class="n">root_node_boolean</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># changes the boolean indicator to identify the root node</span>

        <span class="n">stage_0_pathway</span> <span class="o">=</span> <span class="n">Pathway</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="p">[</span><span class="n">renamed_root_node</span><span class="p">],</span> <span class="n">nature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">stage_0_pathway</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extract_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_sector</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">thresholds_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_stage</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts all the pathways and stores them in the SupplyChain object.</span>
<span class="sd">        :param target_sector: the target sector ID</span>
<span class="sd">        :param thresholds_dict: a dictionary of thresholds for each flow assessed</span>
<span class="sd">        :param max_stage: the maximum stage upstream to be considered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_stage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">=</span> <span class="n">max_stage</span>
        <span class="k">if</span> <span class="n">thresholds_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">thresholds_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span>
        <span class="k">if</span> <span class="n">target_sector</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">target_sector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculations_in_progress</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_stage_1_pathway</span><span class="p">(</span><span class="n">target_sector</span><span class="p">,</span>
                                      <span class="n">thresholds_dict</span><span class="o">=</span><span class="n">thresholds_dict</span><span class="p">)</span>  <span class="c1"># inserted dynamically into class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculations_in_progress</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insert_direct_requirements</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>

    <span class="k">def</span> <span class="nf">_remove_node_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the last Node and Transaction object from the TemporaryList objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">remove_last_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span><span class="o">.</span><span class="n">remove_last_item</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_pathway_already_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the passed Transaction object is already in the last pathway. Use to avoid double storing of pruned</span>
<span class="sd">        pathways.</span>
<span class="sd">        :param transaction: A Transaction object</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transactions</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">test</span>

    <span class="k">def</span> <span class="nf">_temp_nodes_and_temp_transactions_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if BOTH temps nodes AND temp_transactions are empty.</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_get_requirements_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sector_ID</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span> <span class="ow">or</span> <span class="s1">&#39;Direct&#39;</span><span class="p">,</span> <span class="n">flows_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the total or direct requirement of a node for every flow considered in the SupplyChain object.</span>
<span class="sd">        :param sector_ID: the target sector considered</span>
<span class="sd">        :param tech_coeff: technological coefficient in dollar value purchased from the target sector</span>
<span class="sd">        :param mode: whether it calculates direct or total requirements</span>
<span class="sd">        :param flows_list: list of flows considered in the SPA</span>
<span class="sd">        :return: a dictionary of total or direct requirements for each flow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">flows_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;Total&#39;</span><span class="p">:</span>
            <span class="n">requirements_arrays_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;Direct&#39;</span><span class="p">:</span>
            <span class="n">requirements_arrays_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Only Direct or Total requirements can be considered.&#39;</span><span class="p">)</span>
        <span class="n">requirements_sector_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">flow</span><span class="p">:</span> <span class="n">requirements_arrays_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="n">sector_ID</span><span class="p">]</span> <span class="o">*</span> <span class="n">tech_coeff</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span>
                                    <span class="n">flows_list</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">requirements_sector_dict</span>

    <span class="k">def</span> <span class="nf">_get_thresholds_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_requirements_dict</span><span class="p">,</span> <span class="n">custom_threshold_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">custom_flows</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the values in the total requirement dictionary against the thresholds defined for each flow</span>
<span class="sd">        :param total_requirements_dict: dictionary of total coefficient calculated for each flow assessed</span>
<span class="sd">        :param custom_threshold_dict: a customised dictionary of threshold can be used - otherwise the threshold_dict</span>
<span class="sd">        defined at the initialisation of the SupplyChain will be used</span>
<span class="sd">        :param custom_flows: a customised list of flows can be used for the analysis - otherwise the list of flows</span>
<span class="sd">        defined at the initialisation of the SupplyChain will be used</span>
<span class="sd">        :return: a dictionary of test results for each flow assessed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">custom_threshold_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">threshold_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threshold_dict</span> <span class="o">=</span> <span class="n">custom_threshold_dict</span>

        <span class="k">if</span> <span class="n">custom_flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="n">custom_flows</span>

        <span class="n">threshold_test_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">flow</span><span class="p">:</span> <span class="n">total_requirements_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">threshold_test_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_test_thresholds</span><span class="p">(</span><span class="n">threshold_test_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the dictionary of test results for each flow assessed to determine whether or not to continue the</span>
<span class="sd">        extraction. If all test results in the dictionary are FALSE, returns FALSE, if at least one of the results is</span>
<span class="sd">        TRUE, returns TRUE.</span>
<span class="sd">        :param threshold_test_dict: dictionary of test results for each flow assessed against the defined thresholds</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">True</span> <span class="ow">in</span> <span class="n">threshold_test_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_store_pathway_in_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_sector</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target_sector</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">acc_tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">total_coeff_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">threshold_test_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the pathway (nodes and transaction) to the temp_pathway</span>
<span class="sd">        :param input_sector: the input sector considered</span>
<span class="sd">        :param target_sector: the target sector considered</span>
<span class="sd">        :param tech_coeff: the technological coefficient of the sector</span>
<span class="sd">        :param acc_tech_coeff: the accumulated technological coefficient at this stage</span>
<span class="sd">        :param total_coeff_dict: a dictionary of total environmental coefficients for this node</span>
<span class="sd">        :param stage: the current stage</span>
<span class="sd">        :param threshold_test_dict: a dictionary of threshold testing for each flow</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">direct_coeff_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span><span class="p">,</span> <span class="n">test_result</span> <span class="ow">in</span> <span class="n">threshold_test_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">test_result</span><span class="p">:</span>
                <span class="n">direct_coeff_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_tech_coeff</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="n">input_sector</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">direct_coeff_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;process&#39;</span><span class="p">:</span>
            <span class="n">origin_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">index_reference</span><span class="o">=</span><span class="n">input_sector</span><span class="p">,</span>
                               <span class="n">stage</span><span class="o">=</span><span class="n">stage</span><span class="p">,</span>
                               <span class="n">direct_intensities</span><span class="o">=</span><span class="n">direct_coeff_dict</span><span class="p">,</span>
                               <span class="n">total_intensities</span><span class="o">=</span><span class="n">total_coeff_dict</span><span class="p">,</span>
                               <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">input_sector</span><span class="p">][</span><span class="s1">&#39;Unit&#39;</span><span class="p">],</span>
                               <span class="n">nature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The node to be added has no IO or Process nature&#39;</span><span class="p">)</span>

        <span class="c1"># print(&#39;origin node: &#39;, origin_node)</span>
        <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;process&#39;</span><span class="p">:</span>
                <span class="n">target_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">index_reference</span><span class="o">=</span><span class="n">target_sector</span><span class="p">,</span>
                                   <span class="n">stage</span><span class="o">=</span><span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                   <span class="n">direct_intensities</span><span class="o">=</span><span class="n">direct_coeff_dict</span><span class="p">,</span>
                                   <span class="n">total_intensities</span><span class="o">=</span><span class="n">total_coeff_dict</span><span class="p">,</span>
                                   <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">input_sector</span><span class="p">][</span><span class="s1">&#39;Unit&#39;</span><span class="p">],</span>
                                   <span class="n">nature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The node to be added has no IO or Process nature&#39;</span><span class="p">)</span>

        <span class="n">transaction</span> <span class="o">=</span> <span class="n">Transaction</span><span class="p">(</span><span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">,</span> <span class="n">acc_tech_coeff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">already_exists</span><span class="p">(</span><span class="n">target_node</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">complete_analysis_lci</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sector_selection</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                              <span class="n">as_absolute</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                              <span class="n">threshold_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_stage</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyse the total contribution at each stage of the supply chain to the total requirement of every</span>
<span class="sd">        input-output sector or process contained in the database analysed, and copy the results to a csv file.</span>
<span class="sd">        :param path: directory of the file to be created (excluding file name).</span>
<span class="sd">        :param filename: name of the file to be created.</span>
<span class="sd">        :param sector_selection: selection of sector IDs to be assessed within the database - by default the entire</span>
<span class="sd">        database is analysed</span>
<span class="sd">        :param as_absolute: whether the results are provided as absolute values or as a percentage of the total.</span>
<span class="sd">        :param threshold_dict: dict of threshold for each indicator</span>
<span class="sd">        :param max_stage: maximum stage of analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">threshold_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">threshold_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threshold_dict</span> <span class="o">=</span> <span class="n">threshold_dict</span>

        <span class="k">if</span> <span class="n">max_stage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">max_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_stage</span> <span class="o">=</span> <span class="n">max_stage</span>

        <span class="k">if</span> <span class="n">sector_selection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sector_selection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sector_selection</span> <span class="o">=</span> <span class="n">sector_selection</span>

        <span class="n">complete_analysis_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">flow</span><span class="p">:</span> <span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]:</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">sector_selection</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">threshold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="p">}</span>

        <span class="n">complete_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;ALL_SPAs_Threshold_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">threshold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">complete_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">list_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">sector_selection</span><span class="p">:</span>
            <span class="n">spa_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">][:</span><span class="mi">60</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.sc&#39;</span>
            <span class="k">if</span> <span class="n">spa_filename</span> <span class="ow">in</span> <span class="n">list_files</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">=</span> <span class="n">ids</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_root_node</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extract_pathways</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">threshold_dict</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">complete_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">spa_filename</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
                    <span class="n">total_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_per_stage_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">get_coverage_of</span><span class="p">(</span><span class="n">flow</span><span class="p">),</span> <span class="n">flow</span><span class="p">,</span>
                                                                          <span class="n">as_absolute</span><span class="p">)</span>
                    <span class="n">total_dict</span><span class="p">[</span><span class="s1">&#39;Pathways (Total)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of</span><span class="p">(</span><span class="n">count_what</span><span class="o">=</span><span class="s1">&#39;pathways&#39;</span><span class="p">)</span>
                    <span class="n">total_dict</span><span class="p">[</span><span class="s1">&#39;Nodes (Total)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of</span><span class="p">(</span><span class="n">count_what</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
                    <span class="c1"># print(flow)</span>
                    <span class="n">total_dict</span><span class="p">[</span><span class="s1">&#39;Pathways (&#39;</span> <span class="o">+</span> <span class="n">flow</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_nb_pathways_per_flow</span><span class="p">([</span><span class="n">flow</span><span class="p">])[</span>
                        <span class="n">flow</span><span class="p">]</span>
                    <span class="n">complete_analysis_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">total_dict</span>

        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
            <span class="n">df_output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">complete_analysis_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
            <span class="n">df_output</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.csv&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">threshold</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_add_extraction_stage</span><span class="p">(</span><span class="n">stage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function used to create the extraction functions for every stage for which the SPA is conducted. The functions</span>
<span class="sd">    are dynamically created at the initialisation of the SupplyChain Class.</span>
<span class="sd">    :param stage: Stage of the supply chain at which the SPA is conducted/</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fn_name</span> <span class="o">=</span> <span class="s1">&#39;_extract_stage_</span><span class="si">%s</span><span class="s1">_pathway&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fn_extraction_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_sector</span><span class="p">,</span> <span class="n">prev_tech_coeff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">thresholds_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Template for the pathway extraction function.</span>
<span class="sd">        :param self:</span>
<span class="sd">        :param target_sector: Sector considered. At Stage 1 it is the root sector, from the following stages it will be</span>
<span class="sd">        each of the input sector considered in Stage 1.</span>
<span class="sd">        :param prev_tech_coeff: The accumulated technological coefficient. It is equal to 1 at Stage 1, and will then</span>
<span class="sd">        evolve during the next stages up</span>
<span class="sd">        :param thresholds_dict: A dictionary of total requirement threshold.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">thresholds_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">thresholds_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span>
        <span class="k">for</span> <span class="n">input_sector</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">tech_coeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="p">[</span><span class="n">input_sector</span><span class="p">][</span><span class="n">target_sector</span><span class="p">]</span>
            <span class="c1"># Tech_coeff must be declared independently as only used when storing the pathway</span>
            <span class="n">acc_tech_coeff</span> <span class="o">=</span> <span class="n">prev_tech_coeff</span> <span class="o">*</span> <span class="n">tech_coeff</span>
            <span class="c1"># Acc_tech_coef is the technical coefficient downstream, relative to the stage considered</span>
            <span class="c1"># Prev_tech_coeff is the accumulated tech coefficient that is passed from the previous stage and ...</span>
            <span class="c1"># .. updated by the calculation above.</span>
            <span class="n">total_requirements_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_requirements_dict</span><span class="p">(</span><span class="n">input_sector</span><span class="p">,</span> <span class="n">acc_tech_coeff</span><span class="p">,</span> <span class="s1">&#39;Total&#39;</span><span class="p">)</span>
            <span class="n">threshold_test_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_thresholds_test</span><span class="p">(</span><span class="n">total_requirements_dict</span><span class="p">)</span>
            <span class="n">direct_requirement_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_requirements_dict</span><span class="p">(</span><span class="n">input_sector</span><span class="p">,</span> <span class="n">acc_tech_coeff</span><span class="p">,</span> <span class="s1">&#39;Direct&#39;</span><span class="p">)</span>
            <span class="n">direct_requirement_test</span> <span class="o">=</span> \
                <span class="nb">all</span><span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="mf">0.</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="p">[</span><span class="n">direct_requirement_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_thresholds</span><span class="p">(</span><span class="n">threshold_test_dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_store_pathway_in_temp</span><span class="p">(</span><span class="n">input_sector</span><span class="p">,</span> <span class="n">target_sector</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">,</span> <span class="n">acc_tech_coeff</span><span class="p">,</span>
                                            <span class="n">total_requirements_dict</span><span class="p">,</span> <span class="n">stage</span><span class="p">,</span> <span class="n">threshold_test_dict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">stage</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temp_nodes_and_temp_transactions_empty</span><span class="p">():</span>
                        <span class="n">pathway</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_pathway</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pathway_already_saved</span><span class="p">(</span>
                                <span class="n">pathway</span><span class="o">.</span><span class="n">transactions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">direct_requirement_test</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_pathway</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">stage</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">:</span>
                        <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self._extract_stage_</span><span class="si">%s</span><span class="s1">_pathway(input_sector, acc_tech_coeff, thresholds_dict)&#39;</span> <span class="o">%</span>
                             <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

    <span class="nb">setattr</span><span class="p">(</span><span class="n">SupplyChain</span><span class="p">,</span> <span class="n">fn_name</span><span class="p">,</span> <span class="n">fn_extraction_stage</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_spa</span><span class="p">(</span><span class="n">target_ID</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a_matrix_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">thresholds_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SupplyChain</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function in the module, runs a structural path analysis on the target sector/process ID in the specified files,</span>
<span class="sd">    according to the specified thresholds and up to the max_stage upstream in the supply chain</span>
<span class="sd">    :param target_ID: the numerial ID of the target sector/process on which to run the SPA</span>
<span class="sd">    :param max_stage: the maximum number of stages upstream</span>
<span class="sd">    :param a_matrix_file_path: the file path to the technological A matrix, csv or xls</span>
<span class="sd">    :param infosheet_file_path: the file path to the infoosheet, csv or xls</span>
<span class="sd">    :param thresholds_file_path: the file path to the thresholds, csv or xls</span>
<span class="sd">    :param interactive: Boolean that flags if the user wants the code to dynamically ask for input</span>
<span class="sd">    :return: A supply chain object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interface</span> <span class="o">=</span> <span class="n">Interface</span><span class="p">(</span><span class="n">a_matrix_file_path</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">,</span> <span class="n">thresholds_file_path</span><span class="p">)</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">SupplyChain</span><span class="p">(</span><span class="n">target_ID</span><span class="o">=</span><span class="n">target_ID</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># need to remove 1 to align with 0-indexing in python</span>
                     <span class="n">sectors_definition_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">infosheet_dataframe</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">),</span>
                     <span class="n">a_matrix</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">a_matrix</span><span class="p">,</span>
                     <span class="n">dr_vectors_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="p">,</span>
                     <span class="n">tr_vectors_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">tr_vectors_dict</span><span class="p">,</span>
                     <span class="n">thresholds_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">,</span>
                     <span class="n">flows_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">flows_dict</span><span class="p">,</span>
                     <span class="n">max_stage</span><span class="o">=</span><span class="n">max_stage</span>
                     <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Supply Chain object created, extracting pathways, which will take some time...&#39;</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">extract_pathways</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Pathways successfully extracted.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">export_to_csv</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Export them to csv? (yes/no) &gt;&gt;&gt; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">export_to_csv</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yeah&#39;</span><span class="p">]:</span>
            <span class="n">csv_path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please specify the full path of the csv file you want to export to &gt;&gt;&gt; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">export_to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;There was an issue exporting the csv&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;Please specify a csv file (explicitly write .csv at the end)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">sc</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="modules.pyspa.INITIAL_HEADER_LIST" class="name">var <span class="ident">INITIAL_HEADER_LIST</span></p>
      
  
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="modules.pyspa.get_spa">
    <p>def <span class="ident">get_spa</span>(</p><p>target_ID, max_stage, a_matrix_file_path, infosheet_file_path, thresholds_file_path, interactive=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Main function in the module, runs a structural path analysis on the target sector/process ID in the specified files,
according to the specified thresholds and up to the max_stage upstream in the supply chain
:param target_ID: the numerial ID of the target sector/process on which to run the SPA
:param max_stage: the maximum number of stages upstream
:param a_matrix_file_path: the file path to the technological A matrix, csv or xls
:param infosheet_file_path: the file path to the infoosheet, csv or xls
:param thresholds_file_path: the file path to the thresholds, csv or xls
:param interactive: Boolean that flags if the user wants the code to dynamically ask for input
:return: A supply chain object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.get_spa', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.get_spa" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_spa</span><span class="p">(</span><span class="n">target_ID</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a_matrix_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">thresholds_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SupplyChain</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function in the module, runs a structural path analysis on the target sector/process ID in the specified files,</span>
<span class="sd">    according to the specified thresholds and up to the max_stage upstream in the supply chain</span>
<span class="sd">    :param target_ID: the numerial ID of the target sector/process on which to run the SPA</span>
<span class="sd">    :param max_stage: the maximum number of stages upstream</span>
<span class="sd">    :param a_matrix_file_path: the file path to the technological A matrix, csv or xls</span>
<span class="sd">    :param infosheet_file_path: the file path to the infoosheet, csv or xls</span>
<span class="sd">    :param thresholds_file_path: the file path to the thresholds, csv or xls</span>
<span class="sd">    :param interactive: Boolean that flags if the user wants the code to dynamically ask for input</span>
<span class="sd">    :return: A supply chain object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interface</span> <span class="o">=</span> <span class="n">Interface</span><span class="p">(</span><span class="n">a_matrix_file_path</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">,</span> <span class="n">thresholds_file_path</span><span class="p">)</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">SupplyChain</span><span class="p">(</span><span class="n">target_ID</span><span class="o">=</span><span class="n">target_ID</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># need to remove 1 to align with 0-indexing in python</span>
                     <span class="n">sectors_definition_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">infosheet_dataframe</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">),</span>
                     <span class="n">a_matrix</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">a_matrix</span><span class="p">,</span>
                     <span class="n">dr_vectors_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="p">,</span>
                     <span class="n">tr_vectors_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">tr_vectors_dict</span><span class="p">,</span>
                     <span class="n">thresholds_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">,</span>
                     <span class="n">flows_dict</span><span class="o">=</span><span class="n">interface</span><span class="o">.</span><span class="n">flows_dict</span><span class="p">,</span>
                     <span class="n">max_stage</span><span class="o">=</span><span class="n">max_stage</span>
                     <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Supply Chain object created, extracting pathways, which will take some time...&#39;</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">extract_pathways</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Pathways successfully extracted.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interactive</span><span class="p">:</span>
        <span class="n">export_to_csv</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Export them to csv? (yes/no) &gt;&gt;&gt; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">export_to_csv</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yeah&#39;</span><span class="p">]:</span>
            <span class="n">csv_path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please specify the full path of the csv file you want to export to &gt;&gt;&gt; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">export_to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;There was an issue exporting the csv&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;Please specify a csv file (explicitly write .csv at the end)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">sc</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="modules.pyspa.load_instance_from_file">
    <p>def <span class="ident">load_instance_from_file</span>(</p><p>path, type_)</p>
    </div>
    

    
  
    <div class="desc"><p>Unpickles a file and initiates an instance of an object based on the loaded vars
:param path: the path to the pickled file
:param type_: the type of object to load, e.g. a Supply Chain object
:return: the loaded object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.load_instance_from_file', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.load_instance_from_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_instance_from_file</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unpickles a file and initiates an instance of an object based on the loaded vars</span>
<span class="sd">    :param path: the path to the pickled file</span>
<span class="sd">    :param type_: the type of object to load, e.g. a Supply Chain object</span>
<span class="sd">    :return: the loaded object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="n">_load_pickle</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">type_</span><span class="p">(</span><span class="o">**</span><span class="n">loaded</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="modules.pyspa.Interface" class="name">class <span class="ident">Interface</span></p>
      
  
    <div class="desc"><p>Handles the original creation of the supply chain object from csv files</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Interface', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Interface" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Interface</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the original creation of the supply chain object from csv files</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_matrix_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">thresholds_file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the Interface class by providing the paths to all required csv files</span>
<span class="sd">        :param a_matrix_file_path:</span>
<span class="sd">        :param infosheet_file_path:</span>
<span class="sd">        :param thresholds_file_path:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_matrix_file_path</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_flows_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresholds_file_path</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;thresholds_dict&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_loaded_files</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_multipliers_dicts</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;df&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the specified xls or csv file and converts it into a pandas dataframe by default or a numpy array by</span>
<span class="sd">        choice</span>
<span class="sd">        :param path: Path of the xls file to be read</span>
<span class="sd">        :param output: Specify dataframe or array if a numpy array is needed</span>
<span class="sd">        :return: ordered dict of ordered dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="s1">&#39;df&#39;</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;thresholds_dict&#39;</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Output must be &quot;df&quot; or &quot;array&quot; or &quot;thresholds_dict&quot;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">8</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="s1">&#39;df&#39;</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;thresholds_dict&#39;</span><span class="p">:</span>
                    <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Output must be &quot;df&quot; or &quot;array&quot; or &quot;thresholds_dict&quot;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">read_data</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The excel file &#39;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span>
                      <span class="s1">&#39; is too large and will take too long to load. Please convert it to csv and load the csv &#39;</span>
                      <span class="s1">&#39;instead&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;The file should be either a .csv or .xls file&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">read_data</span>

    <span class="k">def</span> <span class="nf">_validate_loaded_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the number of sectors/processes in the A matrix and those in the infosheet dataframe</span>
<span class="sd">        Checks that all units have been provided in the sector infosheet</span>
<span class="sd">        Checks that the flows entered in the thresholds csv file are the same as those in the infosheet</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Your A matrix is not square.</span><span class="se">\n</span><span class="s1"> Please try loading a different file&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_matrix_sectors_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">infosheet_dataframe_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">a_matrix_sectors_num</span> <span class="o">!=</span> <span class="n">infosheet_dataframe_len</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Your A matrix contains &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a_matrix_sectors_num</span><span class="p">)</span>
                                 <span class="o">+</span> <span class="s1">&#39; sectors while your sectors information file contains &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">infosheet_dataframe_len</span><span class="p">)</span> <span class="o">+</span>
                                 <span class="s1">&#39; sectors.</span><span class="se">\n</span><span class="s1"> Please reload matching files&#39;</span><span class="p">)</span>

        <span class="n">satellite_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">satellite</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="k">for</span> <span class="n">satellite</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span>
                             <span class="n">satellite</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DR&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">satellite</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TR&#39;</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">satellite</span> <span class="ow">in</span> <span class="n">satellite_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">satellite</span> <span class="ow">or</span> <span class="s1">&#39;)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">satellite</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;No unit specified for satellite: &#39;</span> <span class="o">+</span> <span class="n">satellite</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;The flows defined in the infosheet are not the same as those defined in the thresholds file&#39;</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The A matrix loaded is square and contains &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; sectors/processes across &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_regions</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39; region(s), and described in the infosheet provided, for &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39; satellite(s)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the regions in ref_dataframe and determines which regions are actually included in the  file</span>
<span class="sd">        :param ref_dataframe: The infosheet containing all information about sectors/processes</span>
<span class="sd">        :return: List of regions</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ref_dataframe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ref_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref_dataframe</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">_get_flows_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the keys in ref_dataframe and determines which environmental flows are included in the excel file</span>
<span class="sd">        :param ref_dataframe: The ordered dictionary generated by xls_to_dict which contains the information and</span>
<span class="sd">        environmental multipliers for each sector</span>
<span class="sd">        :return: List of flows</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ref_dataframe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ref_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span>

        <span class="n">flow</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Flow&#39;</span><span class="p">,</span> <span class="s1">&#39;name, unit&#39;</span><span class="p">)</span>
        <span class="n">attributes_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># generate a dictionary of flows names and flows named tupled by removing &#39;DR&#39; or &#39;TR&#39; from the string</span>
        <span class="c1"># and extracting the unit in between hyphens &#39;()&#39;</span>
        <span class="n">flows_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span> <span class="n">flow</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
                                              <span class="n">item</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">):</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span>
            <span class="n">item</span> <span class="ow">in</span> <span class="n">attributes_list</span> <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;DR_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;TR_&#39;</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">flows_dict</span>

    <span class="k">def</span> <span class="nf">_get_thresholds_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the thresholds csv file as a dataframe and converts it to a dictionary</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_generate_multipliers_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dataframe</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">flows_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the dicts of multipliers based on the reference dataframe and the flows to consider</span>
<span class="sd">        :param ref_dataframe: the infosheet dataframe</span>
<span class="sd">        :param flows_dict: the dictionary of flows considered</span>
<span class="sd">        :return: two dictionaries, one for direct requirements and the other for total reqs. They contain the flow</span>
<span class="sd">        as key and a numpy array of intensities/multipliers as value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ref_dataframe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ref_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span>
        <span class="k">if</span> <span class="n">flows_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span>

        <span class="n">dr_dict</span><span class="p">,</span> <span class="n">tr_dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">flow</span><span class="p">,</span> <span class="n">flow_tuple</span> <span class="ow">in</span> <span class="n">flows_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dr_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_dataframe</span><span class="p">[</span><span class="s1">&#39;DR_&#39;</span> <span class="o">+</span> <span class="n">flow</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">flow_tuple</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
            <span class="n">tr_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_dataframe</span><span class="p">[</span><span class="s1">&#39;TR_&#39;</span> <span class="o">+</span> <span class="n">flow</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">flow_tuple</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">dr_dict</span><span class="p">,</span> <span class="n">tr_dict</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#modules.pyspa.Interface">Interface</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Interface.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, a_matrix_file_path, infosheet_file_path, thresholds_file_path)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiates the Interface class by providing the paths to all required csv files
:param a_matrix_file_path:
:param infosheet_file_path:
:param thresholds_file_path:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Interface.__init__', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Interface.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_matrix_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">thresholds_file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the Interface class by providing the paths to all required csv files</span>
<span class="sd">    :param a_matrix_file_path:</span>
<span class="sd">    :param infosheet_file_path:</span>
<span class="sd">    :param thresholds_file_path:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">infosheet_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infosheet_file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_matrix_file_path</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_flows_dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresholds_file_path</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;thresholds_dict&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_loaded_files</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_multipliers_dicts</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="modules.pyspa.Interface.a_matrix" class="name">var <span class="ident">a_matrix</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Interface.flows_dict" class="name">var <span class="ident">flows_dict</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Interface.infosheet_dataframe" class="name">var <span class="ident">infosheet_dataframe</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Interface.thresholds_dict" class="name">var <span class="ident">thresholds_dict</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="modules.pyspa.Node" class="name">class <span class="ident">Node</span></p>
      
  
    <div class="desc"><p>Represent individual nodes in an input-output supply chain.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Node', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Node" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represent individual nodes in an input-output supply chain.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;index_reference&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;stage&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;direct_intensities&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;total_intensities&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;nature&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;root_node_boolean&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">}</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_reference</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">direct_intensities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                 <span class="n">total_intensities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the node class</span>
<span class="sd">        :param index_reference: index reference of the node, insert sector or process ID (ie the numerical value</span>
<span class="sd">        associated with the sector or process), based on the information sheet provided by the user</span>
<span class="sd">        :param stage: stage of the node in the supply chain, i.e. 0, 1, 2, ..., n</span>
<span class="sd">        :param direct_intensities: dictionary containing DIRECT environmental flows as keys (e.g. energy, water, GHG)</span>
<span class="sd">        and their intensities as values (e.g. 0.5)</span>
<span class="sd">        :param total_intensities: dictionary containing TOTAL environmental flows as keys (e.g. energy, water, GHG)</span>
<span class="sd">        and their intensities as values (e.g. 0.5)</span>
<span class="sd">        :param nature: nature of the data (Process or IO)</span>
<span class="sd">        :param unit: the functional unit of the sector or process represented by that node</span>
<span class="sd">        :return: a handle to the node object created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span> <span class="o">=</span> <span class="n">index_reference</span>  <span class="c1"># numerical index from 1 to the total number of sector or processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="n">stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct_intensities</span> <span class="o">=</span> <span class="n">direct_intensities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_intensities</span> <span class="o">=</span> <span class="n">total_intensities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>  <span class="c1"># IO or Process data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_node_boolean</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># used to check if we are dealing with the root node (Stage 0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># can be added via custom scripts</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Representation of a Node object when printed.</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;Index reference </span><span class="si">%s</span><span class="s1"> [S</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">get_node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the node ID by compounding its name, region and stage</span>
<span class="sd">        :return: node_ID string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">]]</span>
        <span class="n">node_id</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_strings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node_id</span>

    <span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadata or description of the node</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">get_flows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of the flows stored in the node</span>
<span class="sd">        :return: a list of flows</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_intensities</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_node_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an attribute of the Node object</span>
<span class="sd">        :param ref_dict: dictionary of attributes</span>
<span class="sd">        :param attribute: attribute</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node_boolean</span> <span class="ow">and</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;Name&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;DIRECT Stage 0&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ref_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># use for pickled nodes that do not use __slots__</span>
            <span class="k">return</span> <span class="n">ref_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#modules.pyspa.Node">Node</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Node.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, index_reference, stage, direct_intensities, total_intensities, unit, nature=&#39;io&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiates the node class
:param index_reference: index reference of the node, insert sector or process ID (ie the numerical value
associated with the sector or process), based on the information sheet provided by the user
:param stage: stage of the node in the supply chain, i.e. 0, 1, 2, ..., n
:param direct_intensities: dictionary containing DIRECT environmental flows as keys (e.g. energy, water, GHG)
and their intensities as values (e.g. 0.5)
:param total_intensities: dictionary containing TOTAL environmental flows as keys (e.g. energy, water, GHG)
and their intensities as values (e.g. 0.5)
:param nature: nature of the data (Process or IO)
:param unit: the functional unit of the sector or process represented by that node
:return: a handle to the node object created</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Node.__init__', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Node.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_reference</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">direct_intensities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
             <span class="n">total_intensities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the node class</span>
<span class="sd">    :param index_reference: index reference of the node, insert sector or process ID (ie the numerical value</span>
<span class="sd">    associated with the sector or process), based on the information sheet provided by the user</span>
<span class="sd">    :param stage: stage of the node in the supply chain, i.e. 0, 1, 2, ..., n</span>
<span class="sd">    :param direct_intensities: dictionary containing DIRECT environmental flows as keys (e.g. energy, water, GHG)</span>
<span class="sd">    and their intensities as values (e.g. 0.5)</span>
<span class="sd">    :param total_intensities: dictionary containing TOTAL environmental flows as keys (e.g. energy, water, GHG)</span>
<span class="sd">    and their intensities as values (e.g. 0.5)</span>
<span class="sd">    :param nature: nature of the data (Process or IO)</span>
<span class="sd">    :param unit: the functional unit of the sector or process represented by that node</span>
<span class="sd">    :return: a handle to the node object created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span> <span class="o">=</span> <span class="n">index_reference</span>  <span class="c1"># numerical index from 1 to the total number of sector or processes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="n">stage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">direct_intensities</span> <span class="o">=</span> <span class="n">direct_intensities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_intensities</span> <span class="o">=</span> <span class="n">total_intensities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>  <span class="c1"># IO or Process data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root_node_boolean</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># used to check if we are dealing with the root node (Stage 0)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># can be added via custom scripts</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Node.get_flows">
    <p>def <span class="ident">get_flows</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of the flows stored in the node
:return: a list of flows</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Node.get_flows', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Node.get_flows" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_flows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of the flows stored in the node</span>
<span class="sd">    :return: a list of flows</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_intensities</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Node.get_metadata">
    <p>def <span class="ident">get_metadata</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the metadata or description of the node
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Node.get_metadata', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Node.get_metadata" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the metadata or description of the node</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Node.get_node_attribute">
    <p>def <span class="ident">get_node_attribute</span>(</p><p>self, ref_dict, attribute)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns an attribute of the Node object
:param ref_dict: dictionary of attributes
:param attribute: attribute
:return: a string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Node.get_node_attribute', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Node.get_node_attribute" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_node_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an attribute of the Node object</span>
<span class="sd">    :param ref_dict: dictionary of attributes</span>
<span class="sd">    :param attribute: attribute</span>
<span class="sd">    :return: a string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node_boolean</span> <span class="ow">and</span> <span class="n">attribute</span> <span class="o">==</span> <span class="s1">&#39;Name&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;DIRECT Stage 0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ref_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># use for pickled nodes that do not use __slots__</span>
        <span class="k">return</span> <span class="n">ref_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Node.get_node_id">
    <p>def <span class="ident">get_node_id</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates the node ID by compounding its name, region and stage
:return: node_ID string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Node.get_node_id', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Node.get_node_id" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the node ID by compounding its name, region and stage</span>
<span class="sd">    :return: node_ID string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_reference</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">]]</span>
    <span class="n">node_id</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_strings</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">node_id</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="modules.pyspa.Node.direct_intensities" class="name">var <span class="ident">direct_intensities</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Node.index_reference" class="name">var <span class="ident">index_reference</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Node.metadata" class="name">var <span class="ident">metadata</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Node.nature" class="name">var <span class="ident">nature</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Node.root_node_boolean" class="name">var <span class="ident">root_node_boolean</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Node.stage" class="name">var <span class="ident">stage</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Node.total_intensities" class="name">var <span class="ident">total_intensities</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Node.unit" class="name">var <span class="ident">unit</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="modules.pyspa.Pathway" class="name">class <span class="ident">Pathway</span></p>
      
  
    <div class="desc"><p>Represents a single pathway consisting of a series of nodes and transactions</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Pathway</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a single pathway consisting of a series of nodes and transactions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;transactions&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;nature&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">}</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">transactions</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">nature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span>
                 <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the Pathway class.</span>
<span class="sd">        :param nodes: contains a list of consecutive Node Objects</span>
<span class="sd">        :param transactions: contains a list of consecutive Transaction Objects</span>
<span class="sd">        :param nature: type of data (i.e. input-output or process)</span>
<span class="sd">        :param number: adds the number of the pathway in the order of extraction, can be used for lists</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">transactions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">transactions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">transaction</span> <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="n">transactions</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Representation of a Pathway Object when printed</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transaction_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">:</span>
            <span class="n">transaction_string</span> <span class="o">+=</span> <span class="s1">&#39;[T&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">transaction</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span> <span class="o">+</span> \
                                  <span class="n">Transaction</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;Pathway: </span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">transaction_string</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares an instance of pathway to another by checking the equality of its attributes</span>
<span class="sd">        :param other: the other object used in the comparison</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Must be implemented to be able to use pathways in sets</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_id</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares an instance of pathway to another by checking the equality of its attributes</span>
<span class="sd">        :param other: the other object used in the comparison</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled_dict_</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">get_nature</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves nature of pathway, i.e. process or input-output</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nature</span>

    <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the node ID by compounding its name, region and stage</span>
<span class="sd">        :return: pathway_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">())</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
        <span class="n">pathway_id</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_strings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pathway_id</span>

    <span class="k">def</span> <span class="nf">get_short_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a short ID for the pathway, by stitching the sector/process indices</span>
<span class="sd">        :return: pathway_short_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_of_node_indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
        <span class="n">pathway_short_id</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_node_indices</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pathway_short_id</span>

    <span class="k">def</span> <span class="nf">get_num_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the number of nodes</span>
<span class="sd">        :return: The number of nodes (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_num_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the number of transactions</span>
<span class="sd">        :return: The number of transactions (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_for_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the node exists in the Pathway Object</span>
<span class="sd">        :param node: a Node object</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_add_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the nodes of the transaction to the nodes list</span>
<span class="sd">        :param transaction: A transaction object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span><span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_node</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_del_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the origin_node of the transaction as it is the end of the pathway</span>
<span class="sd">        :param transaction: a Transaction object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">origin_node</span><span class="p">)</span>  <span class="c1"># make sure that there are no duplicate nodes</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">add_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a transaction to the Pathway Object by updating both the nodes and transactions list</span>
<span class="sd">        :param transaction: instance of a Transaction Object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_stage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">stage</span><span class="p">,</span> <span class="n">transaction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_nodes</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stage</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The specified transaction has been appended to the end of the pathway&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">del_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a transaction from the Pathway Object</span>
<span class="sd">        :param transaction: location of the Transaction Object to be removed</span>
<span class="sd">        :return: a list of Transaction Objects in the Pathway Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_stage</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_del_node</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="s2">&quot;The specified stage is too far upstream and is not contained in the pathway&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span>

    <span class="k">def</span> <span class="nf">get_direct_env_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the total direct environmental of the pathway</span>
<span class="sd">        :param flows: a list of flows for which we want the intensity</span>
<span class="sd">        :return: intensity of the pathway as a dict with flows as keys and the respective total intensity as values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># convert to float to avoid Numpy type errors in GUI</span>
                    <span class="n">intensity</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">direct_intensity</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;The requested environmental flow [</span><span class="si">%s</span><span class="s1">] could not be found.&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">flow</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">intensity</span>

    <span class="k">def</span> <span class="nf">get_tech_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines the total technological intensity of the pathway or up to a certain stage if specified</span>
<span class="sd">        :param stage: stage at which to get the technological intensity of the pathway</span>
<span class="sd">        :return: tech intensity as a float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">stage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">[</span><span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">accum_tech_coeff</span>

    <span class="k">def</span> <span class="nf">get_fraction_of_total_intensity_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rounding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">percentage</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the ratio of the direct requirement of the last node to the total requirement of the root node</span>
<span class="sd">        :param flow: the name of the environmental flow</span>
<span class="sd">        :param rounding: the number of digits potentially used for rounding</span>
<span class="sd">        :param percentage: return as percentage</span>
<span class="sd">        :return: float: fraction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>

        <span class="c1"># convert to float to avoid Numpy type errors in GUI</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rounding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">fraction</span><span class="p">,</span> <span class="n">rounding</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">percentage</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fraction</span>

    <span class="k">def</span> <span class="nf">get_stage_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">for_gui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">include_stage</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the name of the node for the specified stage</span>
<span class="sd">        :param ref_dict: the sector definition dict of the supply chain object</span>
<span class="sd">        :param stage: the stage in question</span>
<span class="sd">        :param for_gui: boolean flagging if the function is called from a gui</span>
<span class="sd">        :param include_stage: adds a prefix stating the stage of this node</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># need this syntax, not &#39;-1&#39;, to return last item since we need to print stage</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include_stage</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;S</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">for_gui</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;The stage your are trying to access has not been reached in this pathway&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># used for gui</span>
                <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">include_stage</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;S0 </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">get_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rounding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the direct or total intensity of the pathway</span>
<span class="sd">        :param type_: the intensity type, i.e. direct or total</span>
<span class="sd">        :param flow: the name of the environmental flow</span>
<span class="sd">        :param rounding:the number of digits potentially used for rounding</span>
<span class="sd">        :param multiplier: multiply the intensity by this number, typically used to scale IO intensities using price</span>
<span class="sd">        :return: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;direct&#39;</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The type of intensity to calculate must be &quot;direct&quot; or &quot;total&quot;&#39;</span><span class="p">))</span>

        <span class="c1"># convert to float to avoid Numpy type errors in GUI</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">multiplier</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">*=</span> <span class="n">multiplier</span>

        <span class="k">if</span> <span class="n">rounding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">rounding</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">intensity</span>

    <span class="k">def</span> <span class="nf">print_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">streamlined</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                      <span class="n">to_csv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the pathway in ASCii characters as a csv file.</span>
<span class="sd">        :param flow: Flow being analysed</span>
<span class="sd">        :param ref_dict: the sector definition dict of the supply chain object</span>
<span class="sd">        :param streamlined: whether or not the output should be streamlined</span>
<span class="sd">        :param to_csv: whether the output is printed to a csv file or not</span>
<span class="sd">        :return: a string of output summarising data for the pathway</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;{:.5%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>  <span class="c1"># format the percentage of total requirements represented by the pathway</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_fraction_of_total_intensity_for</span><span class="p">(</span><span class="n">flow</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fraction_of_total_intensity_for</span><span class="p">(</span><span class="n">flow</span><span class="p">))</span>
        <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">))</span>
        <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_nodes</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_nodes</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;The pathway is empty, there are no nodes to print&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">start</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">streamlined</span><span class="p">:</span>
                <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
                <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
            <span class="n">output_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                <span class="n">output_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
            <span class="k">return</span> <span class="n">output_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">line_list</span>

    <span class="k">def</span> <span class="nf">get_flows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the set of flows from all Node Objects.</span>
<span class="sd">        :return: a list of flows</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flows_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">flows_set</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">flows_set</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()))</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">flows_set</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the functional unit of the root node</span>
<span class="sd">        :param ref_dict: the sector definition dict of the supply chain object</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Tried to retrieve the unit of the root node but this pathway has no nodes at all&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#modules.pyspa.Pathway">Pathway</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, nodes=None, transactions=None, nature=&#39;io&#39;, number=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiates the Pathway class.
:param nodes: contains a list of consecutive Node Objects
:param transactions: contains a list of consecutive Transaction Objects
:param nature: type of data (i.e. input-output or process)
:param number: adds the number of the pathway in the order of extraction, can be used for lists
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.__init__', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">transactions</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">nature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span>
             <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the Pathway class.</span>
<span class="sd">    :param nodes: contains a list of consecutive Node Objects</span>
<span class="sd">    :param transactions: contains a list of consecutive Transaction Objects</span>
<span class="sd">    :param nature: type of data (i.e. input-output or process)</span>
<span class="sd">    :param number: adds the number of the pathway in the order of extraction, can be used for lists</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">transactions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">transactions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">transaction</span> <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="n">transactions</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.add_transaction">
    <p>def <span class="ident">add_transaction</span>(</p><p>self, transaction)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds a transaction to the Pathway Object by updating both the nodes and transactions list
:param transaction: instance of a Transaction Object
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.add_transaction', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.add_transaction" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a transaction to the Pathway Object by updating both the nodes and transactions list</span>
<span class="sd">    :param transaction: instance of a Transaction Object</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stage</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_stage</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">stage</span><span class="p">,</span> <span class="n">transaction</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_nodes</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stage</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The specified transaction has been appended to the end of the pathway&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.del_transaction">
    <p>def <span class="ident">del_transaction</span>(</p><p>self, transaction)</p>
    </div>
    

    
  
    <div class="desc"><p>Remove a transaction from the Pathway Object
:param transaction: location of the Transaction Object to be removed
:return: a list of Transaction Objects in the Pathway Object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.del_transaction', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.del_transaction" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">del_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove a transaction from the Pathway Object</span>
<span class="sd">    :param transaction: location of the Transaction Object to be removed</span>
<span class="sd">    :return: a list of Transaction Objects in the Pathway Object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stage</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">get_stage</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_del_node</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="s2">&quot;The specified stage is too far upstream and is not contained in the pathway&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_direct_env_intensity">
    <p>def <span class="ident">get_direct_env_intensity</span>(</p><p>self, flows)</p>
    </div>
    

    
  
    <div class="desc"><p>Computes the total direct environmental of the pathway
:param flows: a list of flows for which we want the intensity
:return: intensity of the pathway as a dict with flows as keys and the respective total intensity as values</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_direct_env_intensity', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_direct_env_intensity" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_direct_env_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the total direct environmental of the pathway</span>
<span class="sd">    :param flows: a list of flows for which we want the intensity</span>
<span class="sd">    :return: intensity of the pathway as a dict with flows as keys and the respective total intensity as values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">intensity</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># convert to float to avoid Numpy type errors in GUI</span>
                <span class="n">intensity</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">direct_intensity</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;The requested environmental flow [</span><span class="si">%s</span><span class="s1">] could not be found.&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">flow</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">intensity</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_flows">
    <p>def <span class="ident">get_flows</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieves the set of flows from all Node Objects.
:return: a list of flows</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_flows', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_flows" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_flows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the set of flows from all Node Objects.</span>
<span class="sd">    :return: a list of flows</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flows_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="n">flows_set</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">flows_set</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()))</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">flows_set</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_fraction_of_total_intensity_for">
    <p>def <span class="ident">get_fraction_of_total_intensity_for</span>(</p><p>self, flow, rounding=None, percentage=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculates the ratio of the direct requirement of the last node to the total requirement of the root node
:param flow: the name of the environmental flow
:param rounding: the number of digits potentially used for rounding
:param percentage: return as percentage
:return: float: fraction</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_fraction_of_total_intensity_for', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_fraction_of_total_intensity_for" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_fraction_of_total_intensity_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rounding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">percentage</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the ratio of the direct requirement of the last node to the total requirement of the root node</span>
<span class="sd">    :param flow: the name of the environmental flow</span>
<span class="sd">    :param rounding: the number of digits potentially used for rounding</span>
<span class="sd">    :param percentage: return as percentage</span>
<span class="sd">    :return: float: fraction</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
    <span class="c1"># convert to float to avoid Numpy type errors in GUI</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rounding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">fraction</span><span class="p">,</span> <span class="n">rounding</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">percentage</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fraction</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_id">
    <p>def <span class="ident">get_id</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates the node ID by compounding its name, region and stage
:return: pathway_id</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_id', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_id" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates the node ID by compounding its name, region and stage</span>
<span class="sd">    :return: pathway_id</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">())</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
    <span class="n">pathway_id</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_strings</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pathway_id</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_intensity">
    <p>def <span class="ident">get_intensity</span>(</p><p>self, type_, flow, rounding=None, multiplier=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the direct or total intensity of the pathway
:param type_: the intensity type, i.e. direct or total
:param flow: the name of the environmental flow
:param rounding:the number of digits potentially used for rounding
:param multiplier: multiply the intensity by this number, typically used to scale IO intensities using price
:return: float</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_intensity', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_intensity" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rounding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the direct or total intensity of the pathway</span>
<span class="sd">    :param type_: the intensity type, i.e. direct or total</span>
<span class="sd">    :param flow: the name of the environmental flow</span>
<span class="sd">    :param rounding:the number of digits potentially used for rounding</span>
<span class="sd">    :param multiplier: multiply the intensity by this number, typically used to scale IO intensities using price</span>
<span class="sd">    :return: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;direct&#39;</span><span class="p">:</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The type of intensity to calculate must be &quot;direct&quot; or &quot;total&quot;&#39;</span><span class="p">))</span>
    <span class="c1"># convert to float to avoid Numpy type errors in GUI</span>
    <span class="n">intensity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">multiplier</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">intensity</span> <span class="o">*=</span> <span class="n">multiplier</span>
    <span class="k">if</span> <span class="n">rounding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">intensity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">rounding</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">intensity</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_nature">
    <p>def <span class="ident">get_nature</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieves nature of pathway, i.e. process or input-output
:return: a string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_nature', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_nature" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_nature</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves nature of pathway, i.e. process or input-output</span>
<span class="sd">    :return: a string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nature</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_num_nodes">
    <p>def <span class="ident">get_num_nodes</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieves the number of nodes
:return: The number of nodes (int)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_num_nodes', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_num_nodes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_num_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the number of nodes</span>
<span class="sd">    :return: The number of nodes (int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_num_transactions">
    <p>def <span class="ident">get_num_transactions</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieves the number of transactions
:return: The number of transactions (int)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_num_transactions', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_num_transactions" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_num_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the number of transactions</span>
<span class="sd">    :return: The number of transactions (int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_short_id">
    <p>def <span class="ident">get_short_id</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates a short ID for the pathway, by stitching the sector/process indices
:return: pathway_short_id</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_short_id', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_short_id" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_short_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a short ID for the pathway, by stitching the sector/process indices</span>
<span class="sd">    :return: pathway_short_id</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">list_of_node_indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
    <span class="n">pathway_short_id</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_node_indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pathway_short_id</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_stage_name">
    <p>def <span class="ident">get_stage_name</span>(</p><p>self, ref_dict, stage=None, for_gui=False, include_stage=False)</p>
    </div>
    

    
  
    <div class="desc"><p>returns the name of the node for the specified stage
:param ref_dict: the sector definition dict of the supply chain object
:param stage: the stage in question
:param for_gui: boolean flagging if the function is called from a gui
:param include_stage: adds a prefix stating the stage of this node
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_stage_name', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_stage_name" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_stage_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">for_gui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">include_stage</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns the name of the node for the specified stage</span>
<span class="sd">    :param ref_dict: the sector definition dict of the supply chain object</span>
<span class="sd">    :param stage: the stage in question</span>
<span class="sd">    :param for_gui: boolean flagging if the function is called from a gui</span>
<span class="sd">    :param include_stage: adds a prefix stating the stage of this node</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># need this syntax, not &#39;-1&#39;, to return last item since we need to print stage</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_stage</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;S</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">stage</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">for_gui</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;The stage your are trying to access has not been reached in this pathway&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># used for gui</span>
            <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">include_stage</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;S0 </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_tech_intensity">
    <p>def <span class="ident">get_tech_intensity</span>(</p><p>self, stage=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Determines the total technological intensity of the pathway or up to a certain stage if specified
:param stage: stage at which to get the technological intensity of the pathway
:return: tech intensity as a float</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_tech_intensity', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_tech_intensity" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_tech_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the total technological intensity of the pathway or up to a certain stage if specified</span>
<span class="sd">    :param stage: stage at which to get the technological intensity of the pathway</span>
<span class="sd">    :return: tech intensity as a float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="p">[</span><span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">accum_tech_coeff</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.get_unit">
    <p>def <span class="ident">get_unit</span>(</p><p>self, ref_dict)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieves the functional unit of the root node
:param ref_dict: the sector definition dict of the supply chain object
:return: a string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.get_unit', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.get_unit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the functional unit of the root node</span>
<span class="sd">    :param ref_dict: the sector definition dict of the supply chain object</span>
<span class="sd">    :return: a string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Tried to retrieve the unit of the root node but this pathway has no nodes at all&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Pathway.print_pathway">
    <p>def <span class="ident">print_pathway</span>(</p><p>self, flow, ref_dict, streamlined=True, to_csv=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Prints the pathway in ASCii characters as a csv file.
:param flow: Flow being analysed
:param ref_dict: the sector definition dict of the supply chain object
:param streamlined: whether or not the output should be streamlined
:param to_csv: whether the output is printed to a csv file or not
:return: a string of output summarising data for the pathway</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Pathway.print_pathway', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Pathway.print_pathway" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">print_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">streamlined</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                  <span class="n">to_csv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints the pathway in ASCii characters as a csv file.</span>
<span class="sd">    :param flow: Flow being analysed</span>
<span class="sd">    :param ref_dict: the sector definition dict of the supply chain object</span>
<span class="sd">    :param streamlined: whether or not the output should be streamlined</span>
<span class="sd">    :param to_csv: whether the output is printed to a csv file or not</span>
<span class="sd">    :return: a string of output summarising data for the pathway</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
        <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;{:.5%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>  <span class="c1"># format the percentage of total requirements represented by the pathway</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_fraction_of_total_intensity_for</span><span class="p">(</span><span class="n">flow</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fraction_of_total_intensity_for</span><span class="p">(</span><span class="n">flow</span><span class="p">))</span>
    <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">))</span>
    <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_nodes</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_num_nodes</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;The pathway is empty, there are no nodes to print&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">start</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">streamlined</span><span class="p">:</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
            <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="n">ref_dict</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
        <span class="n">output_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">output_string</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">line_list</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="modules.pyspa.Pathway.nature" class="name">var <span class="ident">nature</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Pathway.nodes" class="name">var <span class="ident">nodes</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Pathway.number" class="name">var <span class="ident">number</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Pathway.transactions" class="name">var <span class="ident">transactions</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="modules.pyspa.PathwayList" class="name">class <span class="ident">PathwayList</span></p>
      
  
    <div class="desc"><p>A class inheriting list but overriding some of its functions to allow for calculations specific to lists of
pathways in the context of hybrid analysis.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PathwayList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class inheriting list but overriding some of its functions to allow for calculations specific to lists of</span>
<span class="sd">    pathways in the context of hybrid analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;object_type&#39;</span><span class="p">:</span> <span class="n">Pathway</span><span class="p">}</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;object_type&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initiate the list instance based on list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_type</span> <span class="o">=</span> <span class="n">Pathway</span>
        <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">get_nature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves nature of pathway</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nature</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_nature</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">nature</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">calculate_direct_requirements_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the sum of all direct requirements of each last node found in the list of pathways provided</span>
<span class="sd">        :param flows_list: list of flows for which direct requirements should be summed</span>
<span class="sd">        :return: a dictionary of summed direct requirements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">summed_direct_requirement_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows_list</span><span class="p">:</span>
            <span class="n">summed_direct_requirement_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">dr</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">summed_direct_requirement_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dr</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">return</span> <span class="n">summed_direct_requirement_dict</span>

    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flows</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplies the direct requirements of last nodes by the specified value if they are io nodes</span>
<span class="sd">        and returns a copy of the list. Used to convert IO results from flow by financial output to flow by physical</span>
<span class="sd">        output.</span>
<span class="sd">        :param value: the scalar value by which to multiply</span>
<span class="sd">        :param flows: if None, get all flows from first node</span>
<span class="sd">        :return: a PathwayList Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span><span class="p">:</span>
                    <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">*=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">temp</span>

    <span class="k">def</span> <span class="nf">get_first_n_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number_of_pathways</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of pathways sorted in descending order for a particular flow, up to a &#39;n&#39; limit.</span>
<span class="sd">        :param flow: The particular flow for which the analysis is performed</span>
<span class="sd">        :param number_of_pathways: The number of pathways to be returned</span>
<span class="sd">        :param value: Price of the material being analysed, use only if pathways_list has not been multiplied before</span>
<span class="sd">        :return: A sorted and sliced PathwayList Object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_last_node_direct_intensity</span><span class="p">(</span><span class="n">pathway</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Nested function to extract the direct intensity of the last node of a pathway, for a given flow. Used to</span>
<span class="sd">            rank pathways</span>
<span class="sd">            :param pathway: Pathway object</span>
<span class="sd">            :return: Direct intensity value for a specific flow</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">number_of_pathways</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PathwayList</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_last_node_direct_intensity</span><span class="p">)[:</span><span class="n">number_of_pathways</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PathwayList</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_last_node_direct_intensity</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_pathways_as_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nb_stages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                                  <span class="n">header_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the PathwayList object as a pandas.DataFrame Object formatted for printing as a csv or Excel file.</span>
<span class="sd">        :param flows_list: list of flows considered in the SPA</span>
<span class="sd">        :param nb_stages: number of stages considered in the SPA</span>
<span class="sd">        :param ref_dict: The dictionary of reference of the SupplyChain object, containing metadata</span>
<span class="sd">        :param streamlined: whether the output is streamlined or not</span>
<span class="sd">        :param header_list: list of strings used as header for the pandas.DataFrame Object</span>
<span class="sd">        :return:ranked pandas DataFrame of pathways</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">header_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">header_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">INITIAL_HEADER_LIST</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_stages</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">streamlined</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1"> direct intensity&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header_list</span> <span class="o">=</span> <span class="n">header_list</span>

        <span class="n">pathway_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">header_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header_list</span><span class="p">)):</span>
            <span class="n">pathway_dict</span><span class="p">[</span><span class="n">header_list</span><span class="p">[</span><span class="n">header_index</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">pathway_data_to_print</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">print_pathway</span><span class="p">(</span><span class="n">flows_list</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">,</span> <span class="n">streamlined</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">header_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header_list</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pathway_dict</span><span class="p">[</span><span class="n">header_list</span><span class="p">[</span><span class="n">header_index</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway_data_to_print</span><span class="p">[</span><span class="n">header_index</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">pathway_dict</span><span class="p">[</span><span class="n">header_list</span><span class="p">[</span><span class="n">header_index</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">pathway_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">pathway_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pathway_df</span>

    <span class="k">def</span> <span class="nf">get_per_stage_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_node</span><span class="p">:</span> <span class="s1">&#39;Node Object&#39;</span><span class="p">,</span> <span class="n">nb_stages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">flow_coverage</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                              <span class="n">as_absolute</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the results of the SPA on a per stage basis. Includes the sum of all direct</span>
<span class="sd">        requirements of Stage nodes, as well as the percentage of the total requirements this represents.</span>
<span class="sd">        :param root_node: Root node of the analysis (original target node)</span>
<span class="sd">        :param nb_stages: Number of stages considered in the SPA</span>
<span class="sd">        :param flow_coverage: Total coverage of the SPA</span>
<span class="sd">        :param flow: flow for which the analysis is run</span>
<span class="sd">        :param as_absolute: whether the results are provided as absolute values or as a percentage of the total.</span>
<span class="sd">        :return: stage_total_dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stage_total_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_stages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Stage 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Remainder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">node_value</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
            <span class="n">node_stage</span> <span class="o">=</span> <span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span><span class="p">)</span>
            <span class="n">stage_total_dict</span><span class="p">[</span><span class="n">node_stage</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">node_value</span><span class="p">)</span>
        <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Remainder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">flow_coverage</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">as_absolute</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stage_number</span><span class="p">,</span> <span class="n">stage_total</span> <span class="ow">in</span> <span class="n">stage_total_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">stage_total_dict</span><span class="p">[</span><span class="n">stage_number</span><span class="p">]</span> <span class="o">/</span> <span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
                <span class="n">stage_total_dict</span><span class="p">[</span><span class="n">stage_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">stage_total_dict</span>

    <span class="k">def</span> <span class="nf">get_nb_pathways_per_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function used to return the number of nodes which include data for each specific flow (because of thresholds</span>
<span class="sd">        testing, some flows are not covered in the direct intensities dict of the nodes).</span>
<span class="sd">        :param flows: list of flows for which the analysis should be conducted.</span>
<span class="sd">        :return: node_count_dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
        <span class="c1"># print(flows)</span>
        <span class="n">node_count_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">flow</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="n">node_count_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">return</span> <span class="n">node_count_dict</span>

    <span class="k">def</span> <span class="nf">get_most_contributing_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectors_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">sectors_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">flows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates through all Pathway objects in the list and account for the overall contribution of a sector</span>
<span class="sd">        :param sectors_list: List of all sectors or processes covered by the database</span>
<span class="sd">        :param sectors_dict: Sectors_definition_dict object - included in the relevant .lci file</span>
<span class="sd">        :param flows: List of flows to be covered</span>
<span class="sd">        :return: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>

        <span class="n">root_total_intensities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="n">root_total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="n">contribution_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">contribution_dict</span><span class="p">[</span><span class="s1">&#39;Direct Stage 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="n">sectors_list</span><span class="p">:</span>
            <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
                <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="n">contribution_dict</span><span class="p">[</span><span class="s1">&#39;Direct Stage 0&#39;</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
                <span class="n">last_node</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">last_node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">last_node</span><span class="o">.</span><span class="n">root_node_boolean</span><span class="p">:</span>
                        <span class="n">node_sector</span> <span class="o">=</span> <span class="s1">&#39;Direct Stage 0&#39;</span>
                        <span class="c1"># print(sectors_dict[last_node.index_reference][&#39;Name&#39;])</span>
                        <span class="n">root_total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">node_sector</span> <span class="o">=</span> <span class="n">sectors_dict</span><span class="p">[</span><span class="n">last_node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
                    <span class="n">contribution_dict</span><span class="p">[</span><span class="n">node_sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="n">last_node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">sector</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">contribution_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
                <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">/</span> <span class="n">root_total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">contribution_dict</span>

    <span class="k">def</span> <span class="nf">update_pathways_from_new_spa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spa_pathways_results_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">return_no_match_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trims a Pathway Object based on a specified max_stage and threshold dictionary</span>
<span class="sd">        :param spa_pathways_results_dict: a dictionary of spa short_ids and pathways as k, v</span>
<span class="sd">        that is used to replace current pathways</span>
<span class="sd">        :param return_no_match_list: a boolean flag to return or not the short_ids of pathways that could&#39;nt be replaced</span>
<span class="sd">        :return: a PathwayList Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_as_ids</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_short_id</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">new_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
        <span class="n">no_match_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">spa_id</span> <span class="ow">in</span> <span class="n">self_as_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spa_pathways_results_dict</span><span class="p">[</span><span class="n">spa_id</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">no_match_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spa_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_no_match_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_list</span><span class="p">,</span> <span class="n">no_match_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_list</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#modules.pyspa.PathwayList">PathwayList</a></li>
          <li>builtins.list</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, *args)</p>
    </div>
    

    
  
    <div class="desc"><p>Initiate the list instance based on list</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.__init__', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initiate the list instance based on list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">object_type</span> <span class="o">=</span> <span class="n">Pathway</span>
    <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.calculate_direct_requirements_dict">
    <p>def <span class="ident">calculate_direct_requirements_dict</span>(</p><p>self, flows_list)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculate the sum of all direct requirements of each last node found in the list of pathways provided
:param flows_list: list of flows for which direct requirements should be summed
:return: a dictionary of summed direct requirements</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.calculate_direct_requirements_dict', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.calculate_direct_requirements_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calculate_direct_requirements_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the sum of all direct requirements of each last node found in the list of pathways provided</span>
<span class="sd">    :param flows_list: list of flows for which direct requirements should be summed</span>
<span class="sd">    :return: a dictionary of summed direct requirements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">summed_direct_requirement_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows_list</span><span class="p">:</span>
        <span class="n">summed_direct_requirement_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_intensity</span><span class="p">(</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">summed_direct_requirement_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="n">summed_direct_requirement_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.get_first_n_pathways">
    <p>def <span class="ident">get_first_n_pathways</span>(</p><p>self, flow, number_of_pathways=None, value=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of pathways sorted in descending order for a particular flow, up to a 'n' limit.
:param flow: The particular flow for which the analysis is performed
:param number_of_pathways: The number of pathways to be returned
:param value: Price of the material being analysed, use only if pathways_list has not been multiplied before
:return: A sorted and sliced PathwayList Object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.get_first_n_pathways', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.get_first_n_pathways" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_first_n_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number_of_pathways</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of pathways sorted in descending order for a particular flow, up to a &#39;n&#39; limit.</span>
<span class="sd">    :param flow: The particular flow for which the analysis is performed</span>
<span class="sd">    :param number_of_pathways: The number of pathways to be returned</span>
<span class="sd">    :param value: Price of the material being analysed, use only if pathways_list has not been multiplied before</span>
<span class="sd">    :return: A sorted and sliced PathwayList Object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">get_last_node_direct_intensity</span><span class="p">(</span><span class="n">pathway</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Nested function to extract the direct intensity of the last node of a pathway, for a given flow. Used to</span>
<span class="sd">        rank pathways</span>
<span class="sd">        :param pathway: Pathway object</span>
<span class="sd">        :return: Direct intensity value for a specific flow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">number_of_pathways</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PathwayList</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_last_node_direct_intensity</span><span class="p">)[:</span><span class="n">number_of_pathways</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PathwayList</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_last_node_direct_intensity</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.get_most_contributing_nodes">
    <p>def <span class="ident">get_most_contributing_nodes</span>(</p><p>self, sectors_list, sectors_dict, flows=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Iterates through all Pathway objects in the list and account for the overall contribution of a sector
:param sectors_list: List of all sectors or processes covered by the database
:param sectors_dict: Sectors_definition_dict object - included in the relevant .lci file
:param flows: List of flows to be covered
:return: dict</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.get_most_contributing_nodes', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.get_most_contributing_nodes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_most_contributing_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectors_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">sectors_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">flows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterates through all Pathway objects in the list and account for the overall contribution of a sector</span>
<span class="sd">    :param sectors_list: List of all sectors or processes covered by the database</span>
<span class="sd">    :param sectors_dict: Sectors_definition_dict object - included in the relevant .lci file</span>
<span class="sd">    :param flows: List of flows to be covered</span>
<span class="sd">    :return: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
    <span class="n">root_total_intensities</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
        <span class="n">root_total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">contribution_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">contribution_dict</span><span class="p">[</span><span class="s1">&#39;Direct Stage 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="n">sectors_list</span><span class="p">:</span>
        <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
        <span class="n">contribution_dict</span><span class="p">[</span><span class="s1">&#39;Direct Stage 0&#39;</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="n">last_node</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">last_node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last_node</span><span class="o">.</span><span class="n">root_node_boolean</span><span class="p">:</span>
                    <span class="n">node_sector</span> <span class="o">=</span> <span class="s1">&#39;Direct Stage 0&#39;</span>
                    <span class="c1"># print(sectors_dict[last_node.index_reference][&#39;Name&#39;])</span>
                    <span class="n">root_total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node_sector</span> <span class="o">=</span> <span class="n">sectors_dict</span><span class="p">[</span><span class="n">last_node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
                <span class="n">contribution_dict</span><span class="p">[</span><span class="n">node_sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="n">last_node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">sector</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">contribution_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">contribution_dict</span><span class="p">[</span><span class="n">sector</span><span class="p">][</span><span class="n">flow</span><span class="p">]</span> <span class="o">/</span> <span class="n">root_total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">contribution_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.get_nature">
    <p>def <span class="ident">get_nature</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieves nature of pathway
:return: a string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.get_nature', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.get_nature" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_nature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves nature of pathway</span>
<span class="sd">    :return: a string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nature</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_nature</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nature</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.get_nb_pathways_per_flow">
    <p>def <span class="ident">get_nb_pathways_per_flow</span>(</p><p>self, flows=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Function used to return the number of nodes which include data for each specific flow (because of thresholds
testing, some flows are not covered in the direct intensities dict of the nodes).
:param flows: list of flows for which the analysis should be conducted.
:return: node_count_dict</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.get_nb_pathways_per_flow', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.get_nb_pathways_per_flow" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_nb_pathways_per_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function used to return the number of nodes which include data for each specific flow (because of thresholds</span>
<span class="sd">    testing, some flows are not covered in the direct intensities dict of the nodes).</span>
<span class="sd">    :param flows: list of flows for which the analysis should be conducted.</span>
<span class="sd">    :return: node_count_dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
    <span class="c1"># print(flows)</span>
    <span class="n">node_count_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">flow</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">node_count_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="n">node_count_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.get_pathways_as_dataframe">
    <p>def <span class="ident">get_pathways_as_dataframe</span>(</p><p>self, flows_list, nb_stages, ref_dict, streamlined=True, header_list=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the PathwayList object as a pandas.DataFrame Object formatted for printing as a csv or Excel file.
:param flows_list: list of flows considered in the SPA
:param nb_stages: number of stages considered in the SPA
:param ref_dict: The dictionary of reference of the SupplyChain object, containing metadata
:param streamlined: whether the output is streamlined or not
:param header_list: list of strings used as header for the pandas.DataFrame Object
:return:ranked pandas DataFrame of pathways</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.get_pathways_as_dataframe', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.get_pathways_as_dataframe" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_pathways_as_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nb_stages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                              <span class="n">header_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the PathwayList object as a pandas.DataFrame Object formatted for printing as a csv or Excel file.</span>
<span class="sd">    :param flows_list: list of flows considered in the SPA</span>
<span class="sd">    :param nb_stages: number of stages considered in the SPA</span>
<span class="sd">    :param ref_dict: The dictionary of reference of the SupplyChain object, containing metadata</span>
<span class="sd">    :param streamlined: whether the output is streamlined or not</span>
<span class="sd">    :param header_list: list of strings used as header for the pandas.DataFrame Object</span>
<span class="sd">    :return:ranked pandas DataFrame of pathways</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">header_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">header_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">INITIAL_HEADER_LIST</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_stages</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">streamlined</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1"> direct intensity&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">header_list</span> <span class="o">=</span> <span class="n">header_list</span>
    <span class="n">pathway_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">header_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header_list</span><span class="p">)):</span>
        <span class="n">pathway_dict</span><span class="p">[</span><span class="n">header_list</span><span class="p">[</span><span class="n">header_index</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">pathway_data_to_print</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">print_pathway</span><span class="p">(</span><span class="n">flows_list</span><span class="p">,</span> <span class="n">ref_dict</span><span class="p">,</span> <span class="n">streamlined</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">header_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header_list</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pathway_dict</span><span class="p">[</span><span class="n">header_list</span><span class="p">[</span><span class="n">header_index</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway_data_to_print</span><span class="p">[</span><span class="n">header_index</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">pathway_dict</span><span class="p">[</span><span class="n">header_list</span><span class="p">[</span><span class="n">header_index</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">pathway_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">pathway_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pathway_df</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.get_per_stage_results">
    <p>def <span class="ident">get_per_stage_results</span>(</p><p>self, root_node, nb_stages, flow_coverage, flow, as_absolute=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculates the results of the SPA on a per stage basis. Includes the sum of all direct
requirements of Stage nodes, as well as the percentage of the total requirements this represents.
:param root_node: Root node of the analysis (original target node)
:param nb_stages: Number of stages considered in the SPA
:param flow_coverage: Total coverage of the SPA
:param flow: flow for which the analysis is run
:param as_absolute: whether the results are provided as absolute values or as a percentage of the total.
:return: stage_total_dict</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.get_per_stage_results', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.get_per_stage_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_per_stage_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_node</span><span class="p">:</span> <span class="s1">&#39;Node Object&#39;</span><span class="p">,</span> <span class="n">nb_stages</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">flow_coverage</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">as_absolute</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the results of the SPA on a per stage basis. Includes the sum of all direct</span>
<span class="sd">    requirements of Stage nodes, as well as the percentage of the total requirements this represents.</span>
<span class="sd">    :param root_node: Root node of the analysis (original target node)</span>
<span class="sd">    :param nb_stages: Number of stages considered in the SPA</span>
<span class="sd">    :param flow_coverage: Total coverage of the SPA</span>
<span class="sd">    :param flow: flow for which the analysis is run</span>
<span class="sd">    :param as_absolute: whether the results are provided as absolute values or as a percentage of the total.</span>
<span class="sd">    :return: stage_total_dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stage_total_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_stages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Stage 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Remainder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">node_value</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
        <span class="n">node_stage</span> <span class="o">=</span> <span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span><span class="p">)</span>
        <span class="n">stage_total_dict</span><span class="p">[</span><span class="n">node_stage</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">node_value</span><span class="p">)</span>
    <span class="n">stage_total_dict</span><span class="p">[</span><span class="s1">&#39;Remainder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">flow_coverage</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">as_absolute</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stage_number</span><span class="p">,</span> <span class="n">stage_total</span> <span class="ow">in</span> <span class="n">stage_total_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">stage_total_dict</span><span class="p">[</span><span class="n">stage_number</span><span class="p">]</span> <span class="o">/</span> <span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
            <span class="n">stage_total_dict</span><span class="p">[</span><span class="n">stage_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">stage_total_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.multiply">
    <p>def <span class="ident">multiply</span>(</p><p>self, value, flows=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Multiplies the direct requirements of last nodes by the specified value if they are io nodes
and returns a copy of the list. Used to convert IO results from flow by financial output to flow by physical
output.
:param value: the scalar value by which to multiply
:param flows: if None, get all flows from first node
:return: a PathwayList Object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.multiply', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.multiply" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flows</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multiplies the direct requirements of last nodes by the specified value if they are io nodes</span>
<span class="sd">    and returns a copy of the list. Used to convert IO results from flow by financial output to flow by physical</span>
<span class="sd">    output.</span>
<span class="sd">    :param value: the scalar value by which to multiply</span>
<span class="sd">    :param flows: if None, get all flows from first node</span>
<span class="sd">    :return: a PathwayList Object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span><span class="p">:</span>
                <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">*=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">temp</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.PathwayList.update_pathways_from_new_spa">
    <p>def <span class="ident">update_pathways_from_new_spa</span>(</p><p>self, spa_pathways_results_dict, return_no_match_list=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Trims a Pathway Object based on a specified max_stage and threshold dictionary
:param spa_pathways_results_dict: a dictionary of spa short_ids and pathways as k, v
that is used to replace current pathways
:param return_no_match_list: a boolean flag to return or not the short_ids of pathways that could'nt be replaced
:return: a PathwayList Object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.PathwayList.update_pathways_from_new_spa', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.PathwayList.update_pathways_from_new_spa" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_pathways_from_new_spa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spa_pathways_results_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">return_no_match_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trims a Pathway Object based on a specified max_stage and threshold dictionary</span>
<span class="sd">    :param spa_pathways_results_dict: a dictionary of spa short_ids and pathways as k, v</span>
<span class="sd">    that is used to replace current pathways</span>
<span class="sd">    :param return_no_match_list: a boolean flag to return or not the short_ids of pathways that could&#39;nt be replaced</span>
<span class="sd">    :return: a PathwayList Object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">self_as_ids</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_short_id</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>
    <span class="n">new_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
    <span class="n">no_match_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">spa_id</span> <span class="ow">in</span> <span class="n">self_as_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spa_pathways_results_dict</span><span class="p">[</span><span class="n">spa_id</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">no_match_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spa_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_no_match_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new_list</span><span class="p">,</span> <span class="n">no_match_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new_list</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="modules.pyspa.PathwayList.object_type" class="name">var <span class="ident">object_type</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="modules.pyspa.SupplyChain" class="name">class <span class="ident">SupplyChain</span></p>
      
  
    <div class="desc"><p>A class representing the entire supply chain associated with an input-output sector or with a process.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">SupplyChain</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class representing the entire supply chain associated with an input-output sector or with a process.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;target_ID&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;sector_definition_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;a_matrix&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="s1">&#39;dr_vectors_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;tr_vectors_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;thresholds_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;max_stage&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;nature&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;header_line&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;chosen_flows_list&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;temp_nodes&#39;</span><span class="p">:</span> <span class="n">TemporaryList</span><span class="p">,</span>
        <span class="s1">&#39;temp_transactions&#39;</span><span class="p">:</span> <span class="n">TemporaryList</span><span class="p">,</span>
        <span class="s1">&#39;pathways_list&#39;</span><span class="p">:</span> <span class="n">PathwayList</span><span class="p">,</span>
        <span class="s1">&#39;root_node&#39;</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="s1">&#39;calculations_in_progress&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="s1">&#39;flows_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">}</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ID</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sectors_definition_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">a_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">dr_vectors_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                 <span class="n">tr_vectors_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">thresholds_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">flows_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
                 <span class="n">nature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span> <span class="n">pathways_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">root_node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the supply chain class.</span>
<span class="sd">        :param target_ID: the target sector number for which the supply chain is created</span>
<span class="sd">        :param sector_definition_dict: a dictionary listing the sector numbers and their characteristics</span>
<span class="sd">        :param a_matrix: the technological matrix of the input-output tables considered</span>
<span class="sd">        :param dr_vectors_dict: a dictionary of vectors of direct flow intensity for each flow assessed and each</span>
<span class="sd">        sector of the A matrix</span>
<span class="sd">        :param tr_vectors_dict: a dictionary of vectors of total flow intensity for each flow assessed and each</span>
<span class="sd">        sector of the A matrix</span>
<span class="sd">        :param thresholds_dict: a dictionary of thresholds for each flow analysed - thresholds can be modified from</span>
<span class="sd">        flow to flow</span>
<span class="sd">        :param flows_dict: a dictionary containing flow names as keys (e.g. &#39;energy&#39;) and a sub dictionary containing</span>
<span class="sd">        the &#39;name&#39; and &#39;unit&#39; of that flow.</span>
<span class="sd">        :param max_stage: the maximum number of stages upstream to consider during the SPA - the ultimate maximum stage</span>
<span class="sd">        is currently five.</span>
<span class="sd">        :param nature: specifies whether the supply chain data is pure input-output or process.</span>
<span class="sd">        :param pathways_list: the list of pathways constituting the supply chain, only used for loading from a pickle</span>
<span class="sd">        :param root_node: the root node object of the supply chain, only used for loading from a pickle</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">=</span> <span class="n">target_ID</span>  <span class="c1"># numerical index of the sector or process being analysed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span> <span class="o">=</span> <span class="n">sectors_definition_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span> <span class="o">=</span> <span class="n">a_matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span> <span class="o">=</span> <span class="n">dr_vectors_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span> <span class="o">=</span> <span class="n">tr_vectors_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span> <span class="o">=</span> <span class="n">flows_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">=</span> <span class="n">max_stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="o">=</span> <span class="n">thresholds_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">header_line</span> <span class="o">=</span> \
            <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f total intensity</span><span class="se">\t</span><span class="s1">direct intensity of last node in pathway</span><span class="se">\t</span><span class="s1">total intensity of pathway</span><span class="se">\t</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span> <span class="o">=</span> <span class="n">TemporaryList</span><span class="p">(</span><span class="n">parent_sc</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span> <span class="o">=</span> <span class="n">TemporaryList</span><span class="p">(</span><span class="n">parent_sc</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s1">&#39;transactions&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pathways_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">pathways_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_data</span><span class="p">()</span>  <span class="c1"># initiate tests on the variables to check that their format is correct</span>

        <span class="k">if</span> <span class="n">root_node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_root_node</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="n">root_node</span>

        <span class="c1"># generate all necessary functions to extract pathways up to the max stage. Avoids recursive code.</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">_add_extraction_stage</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculations_in_progress</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># use as a flag for progress dialogs</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Representation of a SupplyChain object when printed.</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;SupplyChain =&gt; Target: </span><span class="si">%s</span><span class="s1">, Max Stage: </span><span class="si">%s</span><span class="s1">, Nature: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares an instance of a SupplyChain object to another by checking the equality of its attributes</span>
<span class="sd">        :param other: the other object used in the comparison</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">target_ID</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="ow">and</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">max_stage</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares an instance of a supply chain to another by checking the equality of its attributes</span>
<span class="sd">        :param other: the other object used in the comparison</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deep copy function (creates a completely copied object)</span>
<span class="sd">        :param memo: data to be copied</span>
<span class="sd">        :return: copied object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">memo</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">),</span> <span class="n">memo</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">_validate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A series of tests used to validate the initiated data. It verifies whether the dictionary of thresholds</span>
<span class="sd">        provided contains any information, whether it is as long as the list of flows used for the analysis, and</span>
<span class="sd">        whether the thresholds are within acceptable ranges. It then verifies that the dictionary of vectors provided</span>
<span class="sd">        for TR and DR are in line with the flows assessed, and are provided as numpy arrays. Finally it checks if the</span>
<span class="sd">        number of stages set to be considered is within the scope of the code (ie whether or not it is greater than</span>
<span class="sd">        the ultimate maximum stage).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Test on thresholds_dict STARTS</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The thresholds dictionary is empty&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The thresholds dictionary includes </span><span class="si">%s</span><span class="s1"> too many flows&#39;</span> <span class="o">%</span>
                             <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">flow</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">threshold</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">threshold</span> <span class="o">&lt;</span> <span class="mf">0.0000000001</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The threshold defined for </span><span class="si">%s</span><span class="s1"> is outside the scope.&#39;</span> <span class="o">%</span> <span class="n">flow</span><span class="p">)</span>

        <span class="c1"># Test on dr_vector_dict and tr_vector_dict STARTS</span>
        <span class="k">for</span> <span class="n">flow</span><span class="p">,</span> <span class="n">arrays</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">flow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not included in the current list of flows&#39;</span> <span class="o">%</span> <span class="n">flow</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value provided for </span><span class="si">%s</span><span class="s1"> is not a numpy array&#39;</span> <span class="o">%</span> <span class="n">flow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_pathways_as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dictionary containing the pathway index as a key and the pathway object as a value</span>
<span class="sd">        :param list_of_pathway_indices: a custom list of pathway indices</span>
<span class="sd">        :return: a dictionary of pathways with pathway index as keys and a PathwayList object as a value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pathways_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">list_of_pathway_indices</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pathway_num</span><span class="p">,</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">):</span>
                <span class="n">pathways_dict</span><span class="p">[</span><span class="n">pathway_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathway</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span>
                <span class="n">pathways_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pathways_dict</span>

    <span class="k">def</span> <span class="nf">get_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">list_of_pathway_short_ids</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all pathways as a list, or a list of specified pathways, by indices</span>
<span class="sd">        :param list_of_pathway_indices: a custom list of pathway indices</span>
<span class="sd">        :param list_of_pathway_short_ids: a custom list of pathway short ids</span>
<span class="sd">        :return: a PathwayList object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pathways_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">list_of_pathway_indices</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">list_of_pathway_short_ids</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pathways_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>
        <span class="k">elif</span> <span class="n">list_of_pathway_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span>
                <span class="n">pathways_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">list_of_pathway_short_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pathways_list</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">pathway</span> <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_short_id</span><span class="p">()</span> <span class="ow">in</span> <span class="n">list_of_pathway_short_ids</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pathways_list</span>

    <span class="k">def</span> <span class="nf">find_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_indices_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds all Pathway objects in which the specified node indices occur</span>
<span class="sd">        :param node_indices_list: a list of node indices</span>
<span class="sd">        :return: a dictionary of pathways, with node indices as keys and a list of matching pathway indices as a value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matching_pathways</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pathway_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># skip the root node</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">index_reference</span> <span class="ow">in</span> <span class="n">node_indices_list</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matching_pathways</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="n">matching_pathways</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway_number</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">matching_pathways</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathway_number</span><span class="p">]</span>
            <span class="n">pathway_number</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">matching_pathways</span>

    <span class="k">def</span> <span class="nf">get_coverage_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the coverages of the specified flow in the current SupplyChain object</span>
<span class="sd">        :param flow: the specified flow, as a string, e.g. &#39;energy&#39;, &#39;water&#39;, &#39;carbon&#39;</span>
<span class="sd">        :param rounding: round the results to the specified number of digits</span>
<span class="sd">        :return: a ratio of the total intensity covered by the SupplyChain object, as a float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">covered_flows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">flow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">covered_flows</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The specified flow was not covered in this structural path analysis&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_direct_intensity_covered</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># self.root_node.direct_intensities[flow]</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">total_direct_intensity_covered</span> <span class="o">+=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">percentage_covered</span> <span class="o">=</span> <span class="n">total_direct_intensity_covered</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                <span class="n">percentage_covered</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># if the total is zero, then the share is 0</span>

            <span class="k">if</span> <span class="n">rounding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">percentage_covered</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">percentage_covered</span><span class="p">,</span> <span class="n">rounding</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">percentage_covered</span>

    <span class="k">def</span> <span class="nf">get_flows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of flows covered</span>
<span class="sd">        :return: a list object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_root_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the root node of the supply chain</span>
<span class="sd">        :return: a Node object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span>

    <span class="k">def</span> <span class="nf">_generate_root_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the root Node object of the SupplyChain object.</span>
<span class="sd">        :return: a root Node object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_dr_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">node_tr_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
            <span class="n">node_dr_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">]</span>
            <span class="n">node_tr_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;process&#39;</span><span class="p">:</span>
            <span class="n">root_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">index_reference</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">,</span>
                             <span class="n">stage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">direct_intensities</span><span class="o">=</span><span class="n">node_dr_dict</span><span class="p">,</span> <span class="n">total_intensities</span><span class="o">=</span><span class="n">node_tr_dict</span><span class="p">,</span>
                             <span class="n">nature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">,</span>
                             <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">][</span><span class="s1">&#39;Unit&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;The nature of the SupplyChain object was not recognised. Make sure it is either &#39;process&#39; &quot;</span>
                <span class="s2">&quot;or &#39;io&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">root_node</span>

    <span class="k">def</span> <span class="nf">get_number_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count_what</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span> <span class="ow">or</span> <span class="s1">&#39;transactions&#39;</span> <span class="ow">or</span> <span class="s1">&#39;pathways&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the number of nodes in the SupplyChain object.</span>
<span class="sd">        :param count_what: specify what object is being counted, i.e. &#39;nodes&#39;, &#39;transactions&#39;, &#39;pathways&#39;</span>
<span class="sd">        :return: Number of object (int) in the supply chain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;pathways&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">or</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;transactions&#39;</span><span class="p">:</span>
            <span class="n">num_nodes</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">num_transactions</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">:</span>
                <span class="n">num_nodes</span> <span class="o">+=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_num_nodes</span><span class="p">()</span>
                <span class="n">num_transactions</span> <span class="o">+=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_num_transactions</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">num_nodes</span>
            <span class="k">elif</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;transactions&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">num_transactions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Count what must be &#39;nodes&#39;, &#39;transactions&#39;, or &#39;pathways&#39;&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">add_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathway</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the specified Pathway object to the SupplyChain object.</span>
<span class="sd">        :param pathway: a Pathway object</span>
<span class="sd">        :return: an updated PathwayList object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>

    <span class="k">def</span> <span class="nf">remove_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathway</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the specified Pathway object from the SupplyChain object.</span>
<span class="sd">        :param pathway: a Pathway object</span>
<span class="sd">        :return: an updated PathwayList object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>

    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a filename for the supply chain object</span>
<span class="sd">        :param full: boolean referring to whether the filename is requested is long or short.</span>
<span class="sd">        :return: filename string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;sectors&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;process&#39;</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;processes&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The nature of an spa can only be &quot;io&quot; or &quot;process&quot;&#39;</span><span class="p">))</span>

        <span class="n">clean_target_name</span> <span class="o">=</span> <span class="n">_get_clean_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">num_sectors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">flows_str</span> <span class="o">=</span> <span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;{}_threshold_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s1">&#39;SPA&#39;</span><span class="p">,</span>
                <span class="n">clean_target_name</span><span class="p">,</span>
                <span class="s1">&#39;( </span><span class="si">%s</span><span class="s1"> )&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">),</span>
                <span class="s1">&#39;Max_stage&#39;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">),</span>
                <span class="n">flows_str</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">num_sectors</span><span class="p">),</span>
                <span class="n">suffix</span>
            <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s1">&#39;SPA&#39;</span><span class="p">,</span>
                <span class="n">clean_target_name</span><span class="p">,</span>
                <span class="s1">&#39;( </span><span class="si">%s</span><span class="s1"> )&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">),</span>
                <span class="s1">&#39;Max_stage&#39;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">)</span>
            <span class="p">])</span>
        <span class="k">return</span> <span class="n">filename</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the SupplyChain object to a file.</span>
<span class="sd">        :param path: directory where the SupplyChain object is saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">attribute</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span> <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">}</span>
        <span class="n">_save_pickle</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">temp_dict</span>
        <span class="c1"># with gzip.open(path, &#39;wb&#39;) as file:</span>
        <span class="c1">#     pickle.dump(vars(self), file)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the SupplyChain object from a file.</span>
<span class="sd">        :param path: directory from which the SupplyChain object is loaded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="n">loaded_vars</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">=</span> <span class="n">loaded_vars</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">loaded_vars</span><span class="p">[</span><span class="s1">&#39;pathways_list&#39;</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> loaded successfully&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_file_title_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a title block for the file exported reporting a summary of information on the SPA that has been</span>
<span class="sd">        conducted.</span>
<span class="sd">        :param to_csv: boolean flag referencing whether the data is to be saved to csv file or not</span>
<span class="sd">        :return: analysis metadata in the form of a list of strings to be used for the file header</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_title_block</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;target sector: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">])],</span>
            <span class="p">[</span><span class="s1">&#39;sector ID: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;no sectors in A matrix: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
            <span class="p">[</span><span class="s1">&#39;total no pathways extracted: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;stages analysed: &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;date of extraction: &#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%x</span><span class="s2">&quot;</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;time of extraction: &#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%X</span><span class="s2">&quot;</span><span class="p">)]</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
            <span class="n">new_title_block</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file_title_block</span><span class="p">:</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">new_title_block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_title_block</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">file_title_block</span>

    <span class="k">def</span> <span class="nf">_generate_spa_title_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a title block for the SPA results produced for each flows.</span>
<span class="sd">        :param flow: flow being analysed</span>
<span class="sd">        :param to_csv: boolean flag referencing whether the data is to be saved to csv file or not</span>
<span class="sd">        :return: title block of the SPA results for a particular flow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">flow_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The flow </span><span class="si">%s</span><span class="s1"> is not defined&#39;</span> <span class="o">%</span> <span class="n">flow</span><span class="p">)</span>

        <span class="n">spa_title_block_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;flow analysed:&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;unit:&#39;</span><span class="p">,</span>
             <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">flow_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;thresholds:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">])],</span>
            <span class="p">[</span><span class="s1">&#39;direct:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
             <span class="p">(</span><span class="n">flow_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;total:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
             <span class="p">(</span><span class="n">flow_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">get_node_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span> <span class="s1">&#39;Unit&#39;</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f total covered by SPA:&#39;</span><span class="p">,</span> <span class="s2">&quot;{:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_coverage_of</span><span class="p">(</span><span class="n">flow</span><span class="p">)),</span>
             <span class="s1">&#39;Note: Value may differ from sum of percentages in the table due to rounding&#39;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">to_csv</span><span class="p">:</span>
            <span class="n">new_spa_title_block_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">spa_title_block_list</span><span class="p">:</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">new_spa_title_block_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_spa_title_block_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spa_title_block_list</span>

    <span class="k">def</span> <span class="nf">_generate_spa_table_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a header for each table of SPA results.</span>
<span class="sd">        :param streamlined: whether the SPA table results is streamlined or not</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header_line</span> <span class="o">=</span> <span class="n">INITIAL_HEADER_LIST</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">streamlined</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">header_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1"> direct intensity&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">header_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Stage </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">header_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">header_line</span>

    <span class="k">def</span> <span class="nf">prepare_excel_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare SPA for an excel export - compile the data as a series of pandas.DataFrame in a dictionary</span>
<span class="sd">        :param streamlined: whether or not the output is streamlined (i.e. a shorter number of header is defined if</span>
<span class="sd">        streamlined)</span>
<span class="sd">        :return: dictionary of pd.DataFrames</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_data_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">block_title_lists</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_file_title_block</span><span class="p">(</span><span class="n">to_csv</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
            <span class="n">spa_title_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_spa_title_block</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">block_title_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spa_title_block</span><span class="p">)</span>

        <span class="n">updated_block_title_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">list_</span> <span class="ow">in</span> <span class="n">block_title_lists</span><span class="p">:</span>  <span class="c1"># there is one general summary list and as many other list as flows</span>
            <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">:</span>
                <span class="n">modified_row</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span>
                <span class="n">updated_block_title_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_row</span><span class="p">)</span>
            <span class="n">updated_block_title_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">block_title_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">updated_block_title_list</span><span class="p">)</span>
        <span class="n">df_data_dict</span><span class="p">[</span><span class="s1">&#39;Summary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">block_title_df</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
            <span class="n">flow_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_pathways_as_dataframe</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span>
                                                                   <span class="n">streamlined</span><span class="p">)</span>
            <span class="n">df_data_dict</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">flow_df</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df_data_dict</span>

    <span class="k">def</span> <span class="nf">export_to_excel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the SupplyChain object results to a series of excel spreadsheet (according to the number of flows</span>
<span class="sd">        being covered by the Structural Path Analysis)</span>
<span class="sd">        :param path: directory of the file to be created (including directory and name).</span>
<span class="sd">        :param streamlined: whether or not the output is streamlined - meaning that the number of columns of the spa</span>
<span class="sd">        results table will vary to include the DR of all nodes in the pathways, or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
        <span class="n">df_data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_excel_export</span><span class="p">(</span><span class="n">streamlined</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">df_name</span><span class="p">,</span> <span class="n">df_data_list</span> <span class="ow">in</span> <span class="n">df_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">df_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df_data_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="n">df_data_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">export_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the SupplyChain object to a csv file.</span>
<span class="sd">        :param path: directory of the file to be created (including directory and name).</span>
<span class="sd">        :param streamlined: whether or not the output is streamlined (the number of columns of the spa results table</span>
<span class="sd">        will include the DR of all nodes in the pathways, or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
            <span class="n">output_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_file_title_block</span><span class="p">(</span><span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">line</span><span class="p">])</span>
            <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_spa_title_block</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                    <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">line</span><span class="p">])</span>
                <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_spa_table_header</span><span class="p">(</span><span class="n">streamlined</span><span class="p">)])</span>
                <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_first_n_pathways</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">)):</span>
                    <span class="c1"># write up pathways extracted</span>
                    <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">print_pathway</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span> <span class="n">ref_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span>
                                                     <span class="n">streamlined</span><span class="o">=</span><span class="n">streamlined</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">line</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sector_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">property_</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the specified property_ of the sector with the associated ID.</span>
<span class="sd">        :param: sector_id: ID of the sector in the reference dict</span>
<span class="sd">        :param: property_: key name of the property_ to retrieve in the dictionary of reference</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">sector_id</span><span class="p">][</span><span class="n">property_</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The specified property_ &#39;</span><span class="p">,</span> <span class="n">property_</span><span class="p">,</span> <span class="s1">&#39; was not found for sector ID &#39;</span><span class="p">,</span> <span class="n">sector_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="s1">&#39;list of nodes&#39;</span><span class="p">,</span> <span class="n">transactions</span><span class="p">:</span> <span class="s1">&#39;list of transactions&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a list of nodes and a list of transactions into a pathway object.</span>
<span class="sd">        :param nodes: a list of nodes instances</span>
<span class="sd">        :param transactions: a list of transactions instances</span>
<span class="sd">        :return: a Pathway Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the number of the pathway in the list</span>
        <span class="c1"># add 1 to save the first spot for DIRECT requirements</span>
        <span class="c1"># use for logs and to display</span>
        <span class="n">pathway_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">pathway</span> <span class="o">=</span> <span class="n">Pathway</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">transactions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">,</span> <span class="n">pathway_num</span><span class="p">)</span>
        <span class="c1"># pathway.print_pathway(ref_dict=self.sector_definition_dict)</span>
        <span class="k">return</span> <span class="n">pathway</span>

    <span class="k">def</span> <span class="nf">_insert_direct_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts an additional pathway to represent the direct requirements at stage 0 of the supply chain</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">renamed_root_node</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="p">)</span>
        <span class="n">renamed_root_node</span><span class="o">.</span><span class="n">root_node_boolean</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># changes the boolean indicator to identify the root node</span>

        <span class="n">stage_0_pathway</span> <span class="o">=</span> <span class="n">Pathway</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="p">[</span><span class="n">renamed_root_node</span><span class="p">],</span> <span class="n">nature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">stage_0_pathway</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extract_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_sector</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">thresholds_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_stage</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts all the pathways and stores them in the SupplyChain object.</span>
<span class="sd">        :param target_sector: the target sector ID</span>
<span class="sd">        :param thresholds_dict: a dictionary of thresholds for each flow assessed</span>
<span class="sd">        :param max_stage: the maximum stage upstream to be considered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_stage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">=</span> <span class="n">max_stage</span>
        <span class="k">if</span> <span class="n">thresholds_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">thresholds_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span>
        <span class="k">if</span> <span class="n">target_sector</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">target_sector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculations_in_progress</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_stage_1_pathway</span><span class="p">(</span><span class="n">target_sector</span><span class="p">,</span>
                                      <span class="n">thresholds_dict</span><span class="o">=</span><span class="n">thresholds_dict</span><span class="p">)</span>  <span class="c1"># inserted dynamically into class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculations_in_progress</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insert_direct_requirements</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>

    <span class="k">def</span> <span class="nf">_remove_node_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the last Node and Transaction object from the TemporaryList objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">remove_last_item</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span><span class="o">.</span><span class="n">remove_last_item</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_pathway_already_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the passed Transaction object is already in the last pathway. Use to avoid double storing of pruned</span>
<span class="sd">        pathways.</span>
<span class="sd">        :param transaction: A Transaction object</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transactions</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">test</span>

    <span class="k">def</span> <span class="nf">_temp_nodes_and_temp_transactions_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if BOTH temps nodes AND temp_transactions are empty.</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_get_requirements_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sector_ID</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span> <span class="ow">or</span> <span class="s1">&#39;Direct&#39;</span><span class="p">,</span> <span class="n">flows_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the total or direct requirement of a node for every flow considered in the SupplyChain object.</span>
<span class="sd">        :param sector_ID: the target sector considered</span>
<span class="sd">        :param tech_coeff: technological coefficient in dollar value purchased from the target sector</span>
<span class="sd">        :param mode: whether it calculates direct or total requirements</span>
<span class="sd">        :param flows_list: list of flows considered in the SPA</span>
<span class="sd">        :return: a dictionary of total or direct requirements for each flow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">flows_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;Total&#39;</span><span class="p">:</span>
            <span class="n">requirements_arrays_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;Direct&#39;</span><span class="p">:</span>
            <span class="n">requirements_arrays_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Only Direct or Total requirements can be considered.&#39;</span><span class="p">)</span>
        <span class="n">requirements_sector_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">flow</span><span class="p">:</span> <span class="n">requirements_arrays_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="n">sector_ID</span><span class="p">]</span> <span class="o">*</span> <span class="n">tech_coeff</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span>
                                    <span class="n">flows_list</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">requirements_sector_dict</span>

    <span class="k">def</span> <span class="nf">_get_thresholds_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_requirements_dict</span><span class="p">,</span> <span class="n">custom_threshold_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">custom_flows</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the values in the total requirement dictionary against the thresholds defined for each flow</span>
<span class="sd">        :param total_requirements_dict: dictionary of total coefficient calculated for each flow assessed</span>
<span class="sd">        :param custom_threshold_dict: a customised dictionary of threshold can be used - otherwise the threshold_dict</span>
<span class="sd">        defined at the initialisation of the SupplyChain will be used</span>
<span class="sd">        :param custom_flows: a customised list of flows can be used for the analysis - otherwise the list of flows</span>
<span class="sd">        defined at the initialisation of the SupplyChain will be used</span>
<span class="sd">        :return: a dictionary of test results for each flow assessed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">custom_threshold_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">threshold_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threshold_dict</span> <span class="o">=</span> <span class="n">custom_threshold_dict</span>

        <span class="k">if</span> <span class="n">custom_flows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flows</span> <span class="o">=</span> <span class="n">custom_flows</span>

        <span class="n">threshold_test_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">flow</span><span class="p">:</span> <span class="n">total_requirements_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">flows</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">threshold_test_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_test_thresholds</span><span class="p">(</span><span class="n">threshold_test_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the dictionary of test results for each flow assessed to determine whether or not to continue the</span>
<span class="sd">        extraction. If all test results in the dictionary are FALSE, returns FALSE, if at least one of the results is</span>
<span class="sd">        TRUE, returns TRUE.</span>
<span class="sd">        :param threshold_test_dict: dictionary of test results for each flow assessed against the defined thresholds</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">True</span> <span class="ow">in</span> <span class="n">threshold_test_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_store_pathway_in_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_sector</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target_sector</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">acc_tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">total_coeff_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">threshold_test_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the pathway (nodes and transaction) to the temp_pathway</span>
<span class="sd">        :param input_sector: the input sector considered</span>
<span class="sd">        :param target_sector: the target sector considered</span>
<span class="sd">        :param tech_coeff: the technological coefficient of the sector</span>
<span class="sd">        :param acc_tech_coeff: the accumulated technological coefficient at this stage</span>
<span class="sd">        :param total_coeff_dict: a dictionary of total environmental coefficients for this node</span>
<span class="sd">        :param stage: the current stage</span>
<span class="sd">        :param threshold_test_dict: a dictionary of threshold testing for each flow</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">direct_coeff_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">flow</span><span class="p">,</span> <span class="n">test_result</span> <span class="ow">in</span> <span class="n">threshold_test_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">test_result</span><span class="p">:</span>
                <span class="n">direct_coeff_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_tech_coeff</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="n">input_sector</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">direct_coeff_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;process&#39;</span><span class="p">:</span>
            <span class="n">origin_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">index_reference</span><span class="o">=</span><span class="n">input_sector</span><span class="p">,</span>
                               <span class="n">stage</span><span class="o">=</span><span class="n">stage</span><span class="p">,</span>
                               <span class="n">direct_intensities</span><span class="o">=</span><span class="n">direct_coeff_dict</span><span class="p">,</span>
                               <span class="n">total_intensities</span><span class="o">=</span><span class="n">total_coeff_dict</span><span class="p">,</span>
                               <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">input_sector</span><span class="p">][</span><span class="s1">&#39;Unit&#39;</span><span class="p">],</span>
                               <span class="n">nature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The node to be added has no IO or Process nature&#39;</span><span class="p">)</span>

        <span class="c1"># print(&#39;origin node: &#39;, origin_node)</span>
        <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">target_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;process&#39;</span><span class="p">:</span>
                <span class="n">target_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">index_reference</span><span class="o">=</span><span class="n">target_sector</span><span class="p">,</span>
                                   <span class="n">stage</span><span class="o">=</span><span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                   <span class="n">direct_intensities</span><span class="o">=</span><span class="n">direct_coeff_dict</span><span class="p">,</span>
                                   <span class="n">total_intensities</span><span class="o">=</span><span class="n">total_coeff_dict</span><span class="p">,</span>
                                   <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">input_sector</span><span class="p">][</span><span class="s1">&#39;Unit&#39;</span><span class="p">],</span>
                                   <span class="n">nature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The node to be added has no IO or Process nature&#39;</span><span class="p">)</span>

        <span class="n">transaction</span> <span class="o">=</span> <span class="n">Transaction</span><span class="p">(</span><span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">,</span> <span class="n">acc_tech_coeff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">already_exists</span><span class="p">(</span><span class="n">target_node</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">origin_node</span><span class="p">,</span> <span class="n">target_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">complete_analysis_lci</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sector_selection</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                              <span class="n">as_absolute</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                              <span class="n">threshold_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_stage</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyse the total contribution at each stage of the supply chain to the total requirement of every</span>
<span class="sd">        input-output sector or process contained in the database analysed, and copy the results to a csv file.</span>
<span class="sd">        :param path: directory of the file to be created (excluding file name).</span>
<span class="sd">        :param filename: name of the file to be created.</span>
<span class="sd">        :param sector_selection: selection of sector IDs to be assessed within the database - by default the entire</span>
<span class="sd">        database is analysed</span>
<span class="sd">        :param as_absolute: whether the results are provided as absolute values or as a percentage of the total.</span>
<span class="sd">        :param threshold_dict: dict of threshold for each indicator</span>
<span class="sd">        :param max_stage: maximum stage of analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">threshold_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">threshold_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threshold_dict</span> <span class="o">=</span> <span class="n">threshold_dict</span>

        <span class="k">if</span> <span class="n">max_stage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">max_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_stage</span> <span class="o">=</span> <span class="n">max_stage</span>

        <span class="k">if</span> <span class="n">sector_selection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sector_selection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sector_selection</span> <span class="o">=</span> <span class="n">sector_selection</span>

        <span class="n">complete_analysis_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">flow</span><span class="p">:</span> <span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]:</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">sector_selection</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">threshold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="p">}</span>

        <span class="n">complete_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;ALL_SPAs_Threshold_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">threshold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">complete_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">list_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">sector_selection</span><span class="p">:</span>
            <span class="n">spa_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">][:</span><span class="mi">60</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.sc&#39;</span>
            <span class="k">if</span> <span class="n">spa_filename</span> <span class="ow">in</span> <span class="n">list_files</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">=</span> <span class="n">ids</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_root_node</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extract_pathways</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">threshold_dict</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">complete_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">spa_filename</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
                    <span class="n">total_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_per_stage_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">get_coverage_of</span><span class="p">(</span><span class="n">flow</span><span class="p">),</span> <span class="n">flow</span><span class="p">,</span>
                                                                          <span class="n">as_absolute</span><span class="p">)</span>
                    <span class="n">total_dict</span><span class="p">[</span><span class="s1">&#39;Pathways (Total)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of</span><span class="p">(</span><span class="n">count_what</span><span class="o">=</span><span class="s1">&#39;pathways&#39;</span><span class="p">)</span>
                    <span class="n">total_dict</span><span class="p">[</span><span class="s1">&#39;Nodes (Total)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of</span><span class="p">(</span><span class="n">count_what</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
                    <span class="c1"># print(flow)</span>
                    <span class="n">total_dict</span><span class="p">[</span><span class="s1">&#39;Pathways (&#39;</span> <span class="o">+</span> <span class="n">flow</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_nb_pathways_per_flow</span><span class="p">([</span><span class="n">flow</span><span class="p">])[</span>
                        <span class="n">flow</span><span class="p">]</span>
                    <span class="n">complete_analysis_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">total_dict</span>

        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
            <span class="n">df_output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">complete_analysis_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
            <span class="n">df_output</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.csv&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">threshold</span><span class="p">))</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#modules.pyspa.SupplyChain">SupplyChain</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, target_ID, sectors_definition_dict, a_matrix, dr_vectors_dict, tr_vectors_dict, thresholds_dict, flows_dict, max_stage=7, nature=&#39;io&#39;, pathways_list=None, root_node=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiates the supply chain class.
:param target_ID: the target sector number for which the supply chain is created
:param sector_definition_dict: a dictionary listing the sector numbers and their characteristics
:param a_matrix: the technological matrix of the input-output tables considered
:param dr_vectors_dict: a dictionary of vectors of direct flow intensity for each flow assessed and each
sector of the A matrix
:param tr_vectors_dict: a dictionary of vectors of total flow intensity for each flow assessed and each
sector of the A matrix
:param thresholds_dict: a dictionary of thresholds for each flow analysed - thresholds can be modified from
flow to flow
:param flows_dict: a dictionary containing flow names as keys (e.g. 'energy') and a sub dictionary containing
the 'name' and 'unit' of that flow.
:param max_stage: the maximum number of stages upstream to consider during the SPA - the ultimate maximum stage
is currently five.
:param nature: specifies whether the supply chain data is pure input-output or process.
:param pathways_list: the list of pathways constituting the supply chain, only used for loading from a pickle
:param root_node: the root node object of the supply chain, only used for loading from a pickle
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.__init__', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ID</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sectors_definition_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">a_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">dr_vectors_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
             <span class="n">tr_vectors_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">thresholds_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">flows_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
             <span class="n">nature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span> <span class="n">pathways_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">root_node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the supply chain class.</span>
<span class="sd">    :param target_ID: the target sector number for which the supply chain is created</span>
<span class="sd">    :param sector_definition_dict: a dictionary listing the sector numbers and their characteristics</span>
<span class="sd">    :param a_matrix: the technological matrix of the input-output tables considered</span>
<span class="sd">    :param dr_vectors_dict: a dictionary of vectors of direct flow intensity for each flow assessed and each</span>
<span class="sd">    sector of the A matrix</span>
<span class="sd">    :param tr_vectors_dict: a dictionary of vectors of total flow intensity for each flow assessed and each</span>
<span class="sd">    sector of the A matrix</span>
<span class="sd">    :param thresholds_dict: a dictionary of thresholds for each flow analysed - thresholds can be modified from</span>
<span class="sd">    flow to flow</span>
<span class="sd">    :param flows_dict: a dictionary containing flow names as keys (e.g. &#39;energy&#39;) and a sub dictionary containing</span>
<span class="sd">    the &#39;name&#39; and &#39;unit&#39; of that flow.</span>
<span class="sd">    :param max_stage: the maximum number of stages upstream to consider during the SPA - the ultimate maximum stage</span>
<span class="sd">    is currently five.</span>
<span class="sd">    :param nature: specifies whether the supply chain data is pure input-output or process.</span>
<span class="sd">    :param pathways_list: the list of pathways constituting the supply chain, only used for loading from a pickle</span>
<span class="sd">    :param root_node: the root node object of the supply chain, only used for loading from a pickle</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">=</span> <span class="n">target_ID</span>  <span class="c1"># numerical index of the sector or process being analysed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span> <span class="o">=</span> <span class="n">sectors_definition_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a_matrix</span> <span class="o">=</span> <span class="n">a_matrix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dr_vectors_dict</span> <span class="o">=</span> <span class="n">dr_vectors_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tr_vectors_dict</span> <span class="o">=</span> <span class="n">tr_vectors_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span> <span class="o">=</span> <span class="n">flows_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">=</span> <span class="n">max_stage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span> <span class="o">=</span> <span class="n">thresholds_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">header_line</span> <span class="o">=</span> \
        <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f total intensity</span><span class="se">\t</span><span class="s1">direct intensity of last node in pathway</span><span class="se">\t</span><span class="s1">total intensity of pathway</span><span class="se">\t</span><span class="s1">&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flows_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp_nodes</span> <span class="o">=</span> <span class="n">TemporaryList</span><span class="p">(</span><span class="n">parent_sc</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp_transactions</span> <span class="o">=</span> <span class="n">TemporaryList</span><span class="p">(</span><span class="n">parent_sc</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s1">&#39;transactions&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pathways_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">pathways_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_data</span><span class="p">()</span>  <span class="c1"># initiate tests on the variables to check that their format is correct</span>
    <span class="k">if</span> <span class="n">root_node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_root_node</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="n">root_node</span>
    <span class="c1"># generate all necessary functions to extract pathways up to the max stage. Avoids recursive code.</span>
    <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">_add_extraction_stage</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculations_in_progress</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># use as a flag for progress dialogs</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.add_pathway">
    <p>def <span class="ident">add_pathway</span>(</p><p>self, pathway)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds the specified Pathway object to the SupplyChain object.
:param pathway: a Pathway object
:return: an updated PathwayList object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.add_pathway', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.add_pathway" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathway</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds the specified Pathway object to the SupplyChain object.</span>
<span class="sd">    :param pathway: a Pathway object</span>
<span class="sd">    :return: an updated PathwayList object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.complete_analysis_lci">
    <p>def <span class="ident">complete_analysis_lci</span>(</p><p>self, path, filename, sector_selection=None, as_absolute=True, threshold_dict=None, max_stage=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Analyse the total contribution at each stage of the supply chain to the total requirement of every
input-output sector or process contained in the database analysed, and copy the results to a csv file.
:param path: directory of the file to be created (excluding file name).
:param filename: name of the file to be created.
:param sector_selection: selection of sector IDs to be assessed within the database - by default the entire
database is analysed
:param as_absolute: whether the results are provided as absolute values or as a percentage of the total.
:param threshold_dict: dict of threshold for each indicator
:param max_stage: maximum stage of analysis</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.complete_analysis_lci', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.complete_analysis_lci" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">complete_analysis_lci</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sector_selection</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">as_absolute</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                          <span class="n">threshold_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_stage</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyse the total contribution at each stage of the supply chain to the total requirement of every</span>
<span class="sd">    input-output sector or process contained in the database analysed, and copy the results to a csv file.</span>
<span class="sd">    :param path: directory of the file to be created (excluding file name).</span>
<span class="sd">    :param filename: name of the file to be created.</span>
<span class="sd">    :param sector_selection: selection of sector IDs to be assessed within the database - by default the entire</span>
<span class="sd">    database is analysed</span>
<span class="sd">    :param as_absolute: whether the results are provided as absolute values or as a percentage of the total.</span>
<span class="sd">    :param threshold_dict: dict of threshold for each indicator</span>
<span class="sd">    :param max_stage: maximum stage of analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">threshold_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">threshold_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">threshold_dict</span> <span class="o">=</span> <span class="n">threshold_dict</span>
    <span class="k">if</span> <span class="n">max_stage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">max_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_stage</span> <span class="o">=</span> <span class="n">max_stage</span>
    <span class="k">if</span> <span class="n">sector_selection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">sector_selection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sector_selection</span> <span class="o">=</span> <span class="n">sector_selection</span>
    <span class="n">complete_analysis_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">flow</span><span class="p">:</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]:</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">sector_selection</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">threshold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="p">}</span>
    <span class="n">complete_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;ALL_SPAs_Threshold_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">threshold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">complete_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">list_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ids</span> <span class="ow">in</span> <span class="n">sector_selection</span><span class="p">:</span>
        <span class="n">spa_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">][:</span><span class="mi">60</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.sc&#39;</span>
        <span class="k">if</span> <span class="n">spa_filename</span> <span class="ow">in</span> <span class="n">list_files</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">=</span> <span class="n">ids</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_root_node</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">PathwayList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extract_pathways</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">threshold_dict</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">complete_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">spa_filename</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
                <span class="n">total_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_per_stage_results</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">,</span>
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">get_coverage_of</span><span class="p">(</span><span class="n">flow</span><span class="p">),</span> <span class="n">flow</span><span class="p">,</span>
                                                                      <span class="n">as_absolute</span><span class="p">)</span>
                <span class="n">total_dict</span><span class="p">[</span><span class="s1">&#39;Pathways (Total)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of</span><span class="p">(</span><span class="n">count_what</span><span class="o">=</span><span class="s1">&#39;pathways&#39;</span><span class="p">)</span>
                <span class="n">total_dict</span><span class="p">[</span><span class="s1">&#39;Nodes (Total)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of</span><span class="p">(</span><span class="n">count_what</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span><span class="p">)</span>
                <span class="c1"># print(flow)</span>
                <span class="n">total_dict</span><span class="p">[</span><span class="s1">&#39;Pathways (&#39;</span> <span class="o">+</span> <span class="n">flow</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_nb_pathways_per_flow</span><span class="p">([</span><span class="n">flow</span><span class="p">])[</span>
                    <span class="n">flow</span><span class="p">]</span>
                <span class="n">complete_analysis_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">total_dict</span>
    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
        <span class="n">df_output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">complete_analysis_dict</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
        <span class="n">df_output</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\\</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.csv&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">threshold</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.export_to_csv">
    <p>def <span class="ident">export_to_csv</span>(</p><p>self, path=None, streamlined=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Exports the SupplyChain object to a csv file.
:param path: directory of the file to be created (including directory and name).
:param streamlined: whether or not the output is streamlined (the number of columns of the spa results table
will include the DR of all nodes in the pathways, or not.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.export_to_csv', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.export_to_csv" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">export_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exports the SupplyChain object to a csv file.</span>
<span class="sd">    :param path: directory of the file to be created (including directory and name).</span>
<span class="sd">    :param streamlined: whether or not the output is streamlined (the number of columns of the spa results table</span>
<span class="sd">    will include the DR of all nodes in the pathways, or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
        <span class="n">output_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_file_title_block</span><span class="p">(</span><span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">line</span><span class="p">])</span>
        <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_spa_title_block</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">line</span><span class="p">])</span>
            <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_spa_table_header</span><span class="p">(</span><span class="n">streamlined</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_first_n_pathways</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">)):</span>
                <span class="c1"># write up pathways extracted</span>
                <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">print_pathway</span><span class="p">(</span><span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span> <span class="n">ref_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span>
                                                 <span class="n">streamlined</span><span class="o">=</span><span class="n">streamlined</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">line</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">output_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.export_to_excel">
    <p>def <span class="ident">export_to_excel</span>(</p><p>self, path=None, streamlined=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Exports the SupplyChain object results to a series of excel spreadsheet (according to the number of flows
being covered by the Structural Path Analysis)
:param path: directory of the file to be created (including directory and name).
:param streamlined: whether or not the output is streamlined - meaning that the number of columns of the spa
results table will vary to include the DR of all nodes in the pathways, or not.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.export_to_excel', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.export_to_excel" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">export_to_excel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exports the SupplyChain object results to a series of excel spreadsheet (according to the number of flows</span>
<span class="sd">    being covered by the Structural Path Analysis)</span>
<span class="sd">    :param path: directory of the file to be created (including directory and name).</span>
<span class="sd">    :param streamlined: whether or not the output is streamlined - meaning that the number of columns of the spa</span>
<span class="sd">    results table will vary to include the DR of all nodes in the pathways, or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
    <span class="n">df_data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_excel_export</span><span class="p">(</span><span class="n">streamlined</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">df_name</span><span class="p">,</span> <span class="n">df_data_list</span> <span class="ow">in</span> <span class="n">df_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">df_data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">df_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df_data_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="n">df_data_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.extract_pathways">
    <p>def <span class="ident">extract_pathways</span>(</p><p>self, target_sector=None, thresholds_dict=None, max_stage=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Extracts all the pathways and stores them in the SupplyChain object.
:param target_sector: the target sector ID
:param thresholds_dict: a dictionary of thresholds for each flow assessed
:param max_stage: the maximum stage upstream to be considered</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.extract_pathways', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.extract_pathways" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_sector</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">thresholds_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_stage</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts all the pathways and stores them in the SupplyChain object.</span>
<span class="sd">    :param target_sector: the target sector ID</span>
<span class="sd">    :param thresholds_dict: a dictionary of thresholds for each flow assessed</span>
<span class="sd">    :param max_stage: the maximum stage upstream to be considered</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">max_stage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span> <span class="o">=</span> <span class="n">max_stage</span>
    <span class="k">if</span> <span class="n">thresholds_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">thresholds_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span>
    <span class="k">if</span> <span class="n">target_sector</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">target_sector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculations_in_progress</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_extract_stage_1_pathway</span><span class="p">(</span><span class="n">target_sector</span><span class="p">,</span>
                                  <span class="n">thresholds_dict</span><span class="o">=</span><span class="n">thresholds_dict</span><span class="p">)</span>  <span class="c1"># inserted dynamically into class</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculations_in_progress</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_insert_direct_requirements</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.find_pathways">
    <p>def <span class="ident">find_pathways</span>(</p><p>self, node_indices_list)</p>
    </div>
    

    
  
    <div class="desc"><p>Finds all Pathway objects in which the specified node indices occur
:param node_indices_list: a list of node indices
:return: a dictionary of pathways, with node indices as keys and a list of matching pathway indices as a value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.find_pathways', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.find_pathways" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">find_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_indices_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds all Pathway objects in which the specified node indices occur</span>
<span class="sd">    :param node_indices_list: a list of node indices</span>
<span class="sd">    :return: a dictionary of pathways, with node indices as keys and a list of matching pathway indices as a value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matching_pathways</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">pathway_number</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># skip the root node</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">index_reference</span> <span class="ow">in</span> <span class="n">node_indices_list</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matching_pathways</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">matching_pathways</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway_number</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">matching_pathways</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">index_reference</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathway_number</span><span class="p">]</span>
        <span class="n">pathway_number</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">matching_pathways</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.get_coverage_of">
    <p>def <span class="ident">get_coverage_of</span>(</p><p>self, flow, rounding=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Computes the coverages of the specified flow in the current SupplyChain object
:param flow: the specified flow, as a string, e.g. 'energy', 'water', 'carbon'
:param rounding: round the results to the specified number of digits
:return: a ratio of the total intensity covered by the SupplyChain object, as a float</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.get_coverage_of', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.get_coverage_of" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_coverage_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the coverages of the specified flow in the current SupplyChain object</span>
<span class="sd">    :param flow: the specified flow, as a string, e.g. &#39;energy&#39;, &#39;water&#39;, &#39;carbon&#39;</span>
<span class="sd">    :param rounding: round the results to the specified number of digits</span>
<span class="sd">    :return: a ratio of the total intensity covered by the SupplyChain object, as a float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">covered_flows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_flows</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">flow</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">covered_flows</span><span class="p">:</span>
        <span class="k">raise</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The specified flow was not covered in this structural path analysis&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">total_direct_intensity_covered</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># self.root_node.direct_intensities[flow]</span>
        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">total_direct_intensity_covered</span> <span class="o">+=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">direct_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">percentage_covered</span> <span class="o">=</span> <span class="n">total_direct_intensity_covered</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">total_intensities</span><span class="p">[</span><span class="n">flow</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">percentage_covered</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># if the total is zero, then the share is 0</span>
        <span class="k">if</span> <span class="n">rounding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">percentage_covered</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">percentage_covered</span><span class="p">,</span> <span class="n">rounding</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">percentage_covered</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.get_filename">
    <p>def <span class="ident">get_filename</span>(</p><p>self, full=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates a filename for the supply chain object
:param full: boolean referring to whether the filename is requested is long or short.
:return: filename string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.get_filename', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.get_filename" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a filename for the supply chain object</span>
<span class="sd">    :param full: boolean referring to whether the filename is requested is long or short.</span>
<span class="sd">    :return: filename string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;io&#39;</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;sectors&#39;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">==</span> <span class="s1">&#39;process&#39;</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;processes&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The nature of an spa can only be &quot;io&quot; or &quot;process&quot;&#39;</span><span class="p">))</span>
    <span class="n">clean_target_name</span> <span class="o">=</span> <span class="n">_get_clean_filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">][</span><span class="s1">&#39;Name&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
        <span class="n">num_sectors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">flows_str</span> <span class="o">=</span> <span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;{}_threshold_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s1">&#39;SPA&#39;</span><span class="p">,</span>
            <span class="n">clean_target_name</span><span class="p">,</span>
            <span class="s1">&#39;( </span><span class="si">%s</span><span class="s1"> )&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">),</span>
            <span class="s1">&#39;Max_stage&#39;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">),</span>
            <span class="n">flows_str</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">num_sectors</span><span class="p">),</span>
            <span class="n">suffix</span>
        <span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s1">&#39;SPA&#39;</span><span class="p">,</span>
            <span class="n">clean_target_name</span><span class="p">,</span>
            <span class="s1">&#39;( </span><span class="si">%s</span><span class="s1"> )&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span><span class="p">),</span>
            <span class="s1">&#39;Max_stage&#39;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">)</span>
        <span class="p">])</span>
    <span class="k">return</span> <span class="n">filename</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.get_flows">
    <p>def <span class="ident">get_flows</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of flows covered
:return: a list object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.get_flows', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.get_flows" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_flows</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of flows covered</span>
<span class="sd">    :return: a list object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.get_number_of">
    <p>def <span class="ident">get_number_of</span>(</p><p>self, count_what=&#39;nodes&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieves the number of nodes in the SupplyChain object.
:param count_what: specify what object is being counted, i.e. 'nodes', 'transactions', 'pathways'
:return: Number of object (int) in the supply chain</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.get_number_of', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.get_number_of" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_number_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count_what</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span> <span class="ow">or</span> <span class="s1">&#39;transactions&#39;</span> <span class="ow">or</span> <span class="s1">&#39;pathways&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the number of nodes in the SupplyChain object.</span>
<span class="sd">    :param count_what: specify what object is being counted, i.e. &#39;nodes&#39;, &#39;transactions&#39;, &#39;pathways&#39;</span>
<span class="sd">    :return: Number of object (int) in the supply chain</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;pathways&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">or</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;transactions&#39;</span><span class="p">:</span>
        <span class="n">num_nodes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">num_transactions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">:</span>
            <span class="n">num_nodes</span> <span class="o">+=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_num_nodes</span><span class="p">()</span>
            <span class="n">num_transactions</span> <span class="o">+=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_num_transactions</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">num_nodes</span>
        <span class="k">elif</span> <span class="n">count_what</span> <span class="o">==</span> <span class="s1">&#39;transactions&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">num_transactions</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Count what must be &#39;nodes&#39;, &#39;transactions&#39;, or &#39;pathways&#39;&quot;</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.get_pathways">
    <p>def <span class="ident">get_pathways</span>(</p><p>self, list_of_pathway_indices=None, list_of_pathway_short_ids=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns all pathways as a list, or a list of specified pathways, by indices
:param list_of_pathway_indices: a custom list of pathway indices
:param list_of_pathway_short_ids: a custom list of pathway short ids
:return: a PathwayList object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.get_pathways', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.get_pathways" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_pathways</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">list_of_pathway_short_ids</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns all pathways as a list, or a list of specified pathways, by indices</span>
<span class="sd">    :param list_of_pathway_indices: a custom list of pathway indices</span>
<span class="sd">    :param list_of_pathway_short_ids: a custom list of pathway short ids</span>
<span class="sd">    :return: a PathwayList object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pathways_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">list_of_pathway_indices</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">list_of_pathway_short_ids</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">pathways_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>
    <span class="k">elif</span> <span class="n">list_of_pathway_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span>
            <span class="n">pathways_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">list_of_pathway_short_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">pathways_list</span> <span class="o">=</span> \
            <span class="p">[</span><span class="n">pathway</span> <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">get_short_id</span><span class="p">()</span> <span class="ow">in</span> <span class="n">list_of_pathway_short_ids</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pathways_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.get_pathways_as_dict">
    <p>def <span class="ident">get_pathways_as_dict</span>(</p><p>self, list_of_pathway_indices=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates a dictionary containing the pathway index as a key and the pathway object as a value
:param list_of_pathway_indices: a custom list of pathway indices
:return: a dictionary of pathways with pathway index as keys and a PathwayList object as a value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.get_pathways_as_dict', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.get_pathways_as_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_pathways_as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a dictionary containing the pathway index as a key and the pathway object as a value</span>
<span class="sd">    :param list_of_pathway_indices: a custom list of pathway indices</span>
<span class="sd">    :return: a dictionary of pathways with pathway index as keys and a PathwayList object as a value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pathways_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">list_of_pathway_indices</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pathway_num</span><span class="p">,</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">):</span>
            <span class="n">pathways_dict</span><span class="p">[</span><span class="n">pathway_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathway</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">list_of_pathway_indices</span><span class="p">:</span>
            <span class="n">pathways_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pathways_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.get_root_node">
    <p>def <span class="ident">get_root_node</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the root node of the supply chain
:return: a Node object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.get_root_node', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.get_root_node" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_root_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the root node of the supply chain</span>
<span class="sd">    :return: a Node object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_node</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.load">
    <p>def <span class="ident">load</span>(</p><p>self, path)</p>
    </div>
    

    
  
    <div class="desc"><p>Loads the SupplyChain object from a file.
:param path: directory from which the SupplyChain object is loaded</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.load', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.load" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads the SupplyChain object from a file.</span>
<span class="sd">    :param path: directory from which the SupplyChain object is loaded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">loaded_vars</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_ID</span> <span class="o">=</span> <span class="n">loaded_vars</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span> <span class="o">=</span> <span class="n">loaded_vars</span><span class="p">[</span><span class="s1">&#39;pathways_list&#39;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> loaded successfully&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.prepare_excel_export">
    <p>def <span class="ident">prepare_excel_export</span>(</p><p>self, streamlined=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Prepare SPA for an excel export - compile the data as a series of pandas.DataFrame in a dictionary
:param streamlined: whether or not the output is streamlined (i.e. a shorter number of header is defined if
streamlined)
:return: dictionary of pd.DataFrames</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.prepare_excel_export', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.prepare_excel_export" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">prepare_excel_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamlined</span><span class="o">=</span><span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prepare SPA for an excel export - compile the data as a series of pandas.DataFrame in a dictionary</span>
<span class="sd">    :param streamlined: whether or not the output is streamlined (i.e. a shorter number of header is defined if</span>
<span class="sd">    streamlined)</span>
<span class="sd">    :return: dictionary of pd.DataFrames</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_data_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">block_title_lists</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_file_title_block</span><span class="p">(</span><span class="n">to_csv</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
        <span class="n">spa_title_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_spa_title_block</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">to_csv</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">block_title_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spa_title_block</span><span class="p">)</span>
    <span class="n">updated_block_title_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">list_</span> <span class="ow">in</span> <span class="n">block_title_lists</span><span class="p">:</span>  <span class="c1"># there is one general summary list and as many other list as flows</span>
        <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">:</span>
            <span class="n">modified_row</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span>
            <span class="n">updated_block_title_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_row</span><span class="p">)</span>
        <span class="n">updated_block_title_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">block_title_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">updated_block_title_list</span><span class="p">)</span>
    <span class="n">df_data_dict</span><span class="p">[</span><span class="s1">&#39;Summary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">block_title_df</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_flows_list</span><span class="p">:</span>
        <span class="n">flow_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">get_pathways_as_dataframe</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_stage</span><span class="p">,</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">sector_definition_dict</span><span class="p">,</span>
                                                               <span class="n">streamlined</span><span class="p">)</span>
        <span class="n">df_data_dict</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">flow_df</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df_data_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.remove_pathway">
    <p>def <span class="ident">remove_pathway</span>(</p><p>self, pathway)</p>
    </div>
    

    
  
    <div class="desc"><p>Removes the specified Pathway object from the SupplyChain object.
:param pathway: a Pathway object
:return: an updated PathwayList object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.remove_pathway', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.remove_pathway" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_pathway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathway</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes the specified Pathway object from the SupplyChain object.</span>
<span class="sd">    :param pathway: a Pathway object</span>
<span class="sd">    :return: an updated PathwayList object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathways_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.SupplyChain.save">
    <p>def <span class="ident">save</span>(</p><p>self, path)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves the SupplyChain object to a file.
:param path: directory where the SupplyChain object is saved</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.SupplyChain.save', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.SupplyChain.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves the SupplyChain object to a file.</span>
<span class="sd">    :param path: directory where the SupplyChain object is saved</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">attribute</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span> <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">}</span>
    <span class="n">_save_pickle</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">temp_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.a_matrix" class="name">var <span class="ident">a_matrix</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.calculations_in_progress" class="name">var <span class="ident">calculations_in_progress</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.chosen_flows_list" class="name">var <span class="ident">chosen_flows_list</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.dr_vectors_dict" class="name">var <span class="ident">dr_vectors_dict</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.flows_dict" class="name">var <span class="ident">flows_dict</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.header_line" class="name">var <span class="ident">header_line</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.max_stage" class="name">var <span class="ident">max_stage</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.nature" class="name">var <span class="ident">nature</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.pathways_list" class="name">var <span class="ident">pathways_list</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.root_node" class="name">var <span class="ident">root_node</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.sector_definition_dict" class="name">var <span class="ident">sector_definition_dict</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.target_ID" class="name">var <span class="ident">target_ID</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.temp_nodes" class="name">var <span class="ident">temp_nodes</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.temp_transactions" class="name">var <span class="ident">temp_transactions</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.thresholds_dict" class="name">var <span class="ident">thresholds_dict</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.SupplyChain.tr_vectors_dict" class="name">var <span class="ident">tr_vectors_dict</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="modules.pyspa.TemporaryList" class="name">class <span class="ident">TemporaryList</span></p>
      
  
    <div class="desc"><p>A class inheriting list but overriding some of its functions.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.TemporaryList', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.TemporaryList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TemporaryList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class inheriting list but overriding some of its functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;parent_sc&#39;</span><span class="p">:</span> <span class="s1">&#39;SupplyChain&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">}</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_sc</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span> <span class="ow">or</span> <span class="s1">&#39;transactions&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initiate the list instance based on list</span>
<span class="sd">        :param parent_sc: the parent supply chain object</span>
<span class="sd">        :param _type: defines</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_sc</span> <span class="o">=</span> <span class="n">parent_sc</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">_type</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deep copy function (creates a completely copied object)</span>
<span class="sd">        :param memo: data to be copied</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">memo</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">),</span> <span class="n">memo</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">target_node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends an item to the TemporaryList Object.</span>
<span class="sd">        :param item: a node or transaction item to append</span>
<span class="sd">        :param target_node: the target node that the node item is linked to, use only if type is node</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_node</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">(</span><span class="n">target_node</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_nodes_consistency</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Trying to append a node with the wrong stage sequence&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>  <span class="c1"># if we&#39;re adding the root node</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_nodes_consistency</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Trying to append a node with the wrong stage sequence&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># raising the type error is causing trouble with copy.deepcopy</span>
                <span class="c1"># raise TypeError(&#39;The target node passed to the append method is not a Node&#39;)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;transactions&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_transaction_consistency</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="c1"># print(&#39;adding the following transaction ==&gt; &#39;, item)</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Trying to append a transaction with the wrong target node&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># raising the type error is causing trouble with copy.deepcopy</span>
            <span class="c1"># raise TypeError(&#39;The item passed to the append method of the&#39;</span>
            <span class="c1">#                 &#39; TemporaryList class is not a Node or a Transaction&#39;)</span>

    <span class="k">def</span> <span class="nf">already_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the item is already in the TemporaryList object</span>
<span class="sd">        :param item: A Node or Transaction object</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleans up the list by removing superfluous nodes/transactions</span>
<span class="sd">        :param target: A Node or Transaction object to be cleaned up from the TemporaryList object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&#39;============== CLEANING UP == &#39;, self._type)</span>
        <span class="c1"># print(&#39;state BEFORE cleanup --&gt; &#39;, self)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cleanup_index</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_from_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># print(&#39;\n&#39;,&#39;state AFTER cleanup --&gt; &#39;, self, &#39;\n\n&#39;)</span>

    <span class="k">def</span> <span class="nf">_clear_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Truncates the TemporaryList object from the index onwards, keeps only the first part</span>
<span class="sd">        :param index: the index that we use to truncate the list</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;transactions&#39;</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">==</span> <span class="s1">&#39;clear transactions list&#39;</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span>  <span class="c1"># empties the lists</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_get_cleanup_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Node</span> <span class="ow">or</span> <span class="n">Transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines the index in the TemporaryList object until which we need to keep the elements</span>
<span class="sd">        :param target: A Node or Transaction object that is used to determine the index from which the list is cleared</span>
<span class="sd">        :return: the index in question</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
            <span class="n">target_node_id</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">running_index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="o">==</span> <span class="n">target_node_id</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">running_index</span>
            <span class="k">return</span> <span class="n">index</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
            <span class="n">target_node_id</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">target_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">target_node_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_sc</span><span class="o">.</span><span class="n">root_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">():</span>
                <span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;clear transactions list&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">running_index</span><span class="p">,</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="n">running_origin_node_id</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">origin_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">running_origin_node_id</span> <span class="o">==</span> <span class="n">target_node_id</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">running_index</span>
            <span class="k">return</span> <span class="n">index</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The target item passed is neither a Node nor a Transaction object&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_last_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the last node/transaction in the TemporaryList object</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the TemporaryList object is empty</span>
<span class="sd">        :return: True or false</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_check_nodes_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes sure that all nodes in the TemporaryList object are properly ordered by stage</span>
<span class="sd">        :return: True or false</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="c1"># print(&#39;temp nodes is empty -&gt; Can add node&#39;)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># print(&#39;temp nodes has one node -&gt; can add node&#39;)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="n">node</span><span class="o">.</span><span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># print(&#39;Stages of node to add is sequentially consistent...adding node&#39;)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if the stage of the node to append is not sequentially correct</span>
            <span class="c1"># print(&#39;NODES INCONSISTENT&#39;)</span>
            <span class="c1"># print(&#39;Stage of last node in temp -- &gt; &#39;, self[-1].stage)</span>
            <span class="c1"># print(&#39;Stage of node to add  -- &gt; &#39;, node.stage)</span>
            <span class="c1"># print(&#39;state of temp_nodes --&gt; &#39;, self)</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_check_transaction_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes sure that all Transaction objects in the TemporaryList object are properly ordered in terms of origin</span>
<span class="sd">        and target Node objects.</span>
<span class="sd">        :param transaction: a Transaction object</span>
<span class="sd">        :return: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">origin_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="o">==</span> <span class="n">transaction</span><span class="o">.</span><span class="n">target_node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">():</span>
            <span class="c1"># print(&#39;Stages of node to add is sequentially consistent...adding node&#39;)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if the stage of the node to append is not sequentially correct</span>
            <span class="c1"># print(&#39;NODES INCONSISTENT&#39;)</span>
            <span class="c1"># print(&#39;Stage of last node in temp -- &gt; &#39;, self[-1].stage)</span>
            <span class="c1"># print(&#39;Stage of node to add  -- &gt; &#39;, node.stage)</span>
            <span class="c1"># print(&#39;state of temp_nodes --&gt; &#39;, self)</span>
            <span class="k">return</span> <span class="bp">False</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#modules.pyspa.TemporaryList">TemporaryList</a></li>
          <li>builtins.list</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="modules.pyspa.TemporaryList.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, parent_sc, _type=&#39;nodes&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Initiate the list instance based on list
:param parent_sc: the parent supply chain object
:param _type: defines
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.TemporaryList.__init__', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.TemporaryList.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_sc</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span> <span class="ow">or</span> <span class="s1">&#39;transactions&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initiate the list instance based on list</span>
<span class="sd">    :param parent_sc: the parent supply chain object</span>
<span class="sd">    :param _type: defines</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent_sc</span> <span class="o">=</span> <span class="n">parent_sc</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">_type</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.TemporaryList.already_exists">
    <p>def <span class="ident">already_exists</span>(</p><p>self, item)</p>
    </div>
    

    
  
    <div class="desc"><p>Checks if the item is already in the TemporaryList object
:param item: A Node or Transaction object
:return: True or False</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.TemporaryList.already_exists', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.TemporaryList.already_exists" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">already_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the item is already in the TemporaryList object</span>
<span class="sd">    :param item: A Node or Transaction object</span>
<span class="sd">    :return: True or False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
        <span class="n">id_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">get_node_id</span><span class="p">()</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.TemporaryList.append">
    <p>def <span class="ident">append</span>(</p><p>self, item, target_node=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Appends an item to the TemporaryList Object.
:param item: a node or transaction item to append
:param target_node: the target node that the node item is linked to, use only if type is node
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.TemporaryList.append', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.TemporaryList.append" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">target_node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Appends an item to the TemporaryList Object.</span>
<span class="sd">    :param item: a node or transaction item to append</span>
<span class="sd">    :param target_node: the target node that the node item is linked to, use only if type is node</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_node</span><span class="p">,</span> <span class="n">Node</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">(</span><span class="n">target_node</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_nodes_consistency</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Trying to append a node with the wrong stage sequence&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>  <span class="c1"># if we&#39;re adding the root node</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_nodes_consistency</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Trying to append a node with the wrong stage sequence&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># raising the type error is causing trouble with copy.deepcopy</span>
            <span class="c1"># raise TypeError(&#39;The target node passed to the append method is not a Node&#39;)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="s1">&#39;transactions&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_transaction_consistency</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="c1"># print(&#39;adding the following transaction ==&gt; &#39;, item)</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Trying to append a transaction with the wrong target node&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># raising the type error is causing trouble with copy.deepcopy</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.TemporaryList.is_empty">
    <p>def <span class="ident">is_empty</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Checks if the TemporaryList object is empty
:return: True or false</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.TemporaryList.is_empty', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.TemporaryList.is_empty" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the TemporaryList object is empty</span>
<span class="sd">    :return: True or false</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.TemporaryList.remove_last_item">
    <p>def <span class="ident">remove_last_item</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Removes the last node/transaction in the TemporaryList object
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.TemporaryList.remove_last_item', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.TemporaryList.remove_last_item" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_last_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes the last node/transaction in the TemporaryList object</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="modules.pyspa.TemporaryList.parent_sc" class="name">var <span class="ident">parent_sc</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="modules.pyspa.Transaction" class="name">class <span class="ident">Transaction</span></p>
      
  
    <div class="desc"><p>Represents a single transaction between two nodes in a supply chain.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Transaction', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Transaction" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Transaction</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a single transaction between two nodes in a supply chain.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_slots_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;origin_node&#39;</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="s1">&#39;target_node&#39;</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
        <span class="s1">&#39;tech_coeff&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;accum_tech_coeff&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;nature&#39;</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">}</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_slots_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_node</span><span class="p">:</span> <span class="s2">&quot;Node Object&quot;</span><span class="p">,</span> <span class="n">target_node</span><span class="p">:</span> <span class="s2">&quot;Node Object&quot;</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">accum_tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nature</span><span class="o">=</span><span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the transaction class</span>
<span class="sd">        :param origin_node: Node object from which the transaction originates</span>
<span class="sd">        :param target_node: Node object at which the transaction ends</span>
<span class="sd">        :param tech_coeff: absolute technological intensity of the transaction, not related to the studied</span>
<span class="sd">        node downstream</span>
<span class="sd">        :param accum_tech_coeff: technological intensity of the transaction in relation to the studied node downstream</span>
<span class="sd">        :param nature: nature of the transaction, either Input-Output or Process</span>
<span class="sd">        :return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span> <span class="o">=</span> <span class="n">origin_node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span> <span class="o">=</span> <span class="n">target_node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tech_coeff</span> <span class="o">=</span> <span class="n">tech_coeff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accum_tech_coeff</span> <span class="o">=</span> <span class="n">accum_tech_coeff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Representation of a Transaction object when printed.</span>
<span class="sd">        :return: a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;transaction from </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;/// &#39;</span> <span class="o">+</span> \
               <span class="s1">&#39;[Tech coeff: </span><span class="si">%s</span><span class="s1"> / Accumulated tech coeff: </span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tech_coeff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">accum_tech_coeff</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the attributes from a pickled state</span>
<span class="sd">        :param pickled_dict: the pickled __dict__</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">pickled_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">pickled_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dict of internal variables</span>
<span class="sd">        :return: a dict object of internal variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_to_pickle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dict_to_pickle</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># accommodates earlier versions of the instance which don&#39;t use __slots__</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dict_to_pickle</span>

    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the origin and target nodes</span>
<span class="sd">        :param as_list: define format</span>
<span class="sd">        :return: origin and target node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">as_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the stage of the transaction</span>
<span class="sd">        :return: stage of the origin node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="o">.</span><span class="n">stage</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#modules.pyspa.Transaction">Transaction</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Transaction.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, origin_node, target_node, tech_coeff, accum_tech_coeff, nature=&#39;io&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiates the transaction class
:param origin_node: Node object from which the transaction originates
:param target_node: Node object at which the transaction ends
:param tech_coeff: absolute technological intensity of the transaction, not related to the studied
node downstream
:param accum_tech_coeff: technological intensity of the transaction in relation to the studied node downstream
:param nature: nature of the transaction, either Input-Output or Process
:return</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Transaction.__init__', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Transaction.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin_node</span><span class="p">:</span> <span class="s2">&quot;Node Object&quot;</span><span class="p">,</span> <span class="n">target_node</span><span class="p">:</span> <span class="s2">&quot;Node Object&quot;</span><span class="p">,</span> <span class="n">tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">accum_tech_coeff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nature</span><span class="o">=</span><span class="s1">&#39;io&#39;</span> <span class="ow">or</span> <span class="s1">&#39;process&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the transaction class</span>
<span class="sd">    :param origin_node: Node object from which the transaction originates</span>
<span class="sd">    :param target_node: Node object at which the transaction ends</span>
<span class="sd">    :param tech_coeff: absolute technological intensity of the transaction, not related to the studied</span>
<span class="sd">    node downstream</span>
<span class="sd">    :param accum_tech_coeff: technological intensity of the transaction in relation to the studied node downstream</span>
<span class="sd">    :param nature: nature of the transaction, either Input-Output or Process</span>
<span class="sd">    :return</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span> <span class="o">=</span> <span class="n">origin_node</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span> <span class="o">=</span> <span class="n">target_node</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tech_coeff</span> <span class="o">=</span> <span class="n">tech_coeff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accum_tech_coeff</span> <span class="o">=</span> <span class="n">accum_tech_coeff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nature</span> <span class="o">=</span> <span class="n">nature</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Transaction.get_nodes">
    <p>def <span class="ident">get_nodes</span>(</p><p>self, as_list=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the origin and target nodes
:param as_list: define format
:return: origin and target node</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Transaction.get_nodes', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Transaction.get_nodes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the origin and target nodes</span>
<span class="sd">    :param as_list: define format</span>
<span class="sd">    :return: origin and target node</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">as_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_node</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="modules.pyspa.Transaction.get_stage">
    <p>def <span class="ident">get_stage</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the stage of the transaction
:return: stage of the origin node</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-modules.pyspa.Transaction.get_stage', this);">Show source &equiv;</a></p>
  <div id="source-modules.pyspa.Transaction.get_stage" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the stage of the transaction</span>
<span class="sd">    :return: stage of the origin node</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_node</span><span class="o">.</span><span class="n">stage</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="modules.pyspa.Transaction.accum_tech_coeff" class="name">var <span class="ident">accum_tech_coeff</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Transaction.nature" class="name">var <span class="ident">nature</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Transaction.origin_node" class="name">var <span class="ident">origin_node</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Transaction.target_node" class="name">var <span class="ident">target_node</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="modules.pyspa.Transaction.tech_coeff" class="name">var <span class="ident">tech_coeff</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>